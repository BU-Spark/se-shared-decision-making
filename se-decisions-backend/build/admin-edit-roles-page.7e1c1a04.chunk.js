(self.webpackChunkse_decisions_backend=self.webpackChunkse_decisions_backend||[]).push([[2544],{23341:(z,U,u)=>{"use strict";u.r(U),u.d(U,{CreatePage:()=>ae,default:()=>ce});var e=u(67294),P=u(47292),i=u(95489),C=u(28702),l=u(41363),D=u(80831),V=u(27361),W=u.n(V),J=u(41609),L=u.n(J),E=u(97132),pe=u(49656),Q=u(27821),_=u(18280),ge=u(48474),G=u(87751),re=u(53209);const ee=re.Ry().shape({name:re.Z_().required(i.translatedErrors.required),description:re.Z_().required(i.translatedErrors.required)}),Se=Q.default.div`
  border: 1px solid ${({theme:B})=>B.colors.primary200};
  background: ${({theme:B})=>B.colors.primary100};
  padding: ${({theme:B})=>`${B.spaces[2]} ${B.spaces[4]}`};
  color: ${({theme:B})=>B.colors.primary600};
  border-radius: ${({theme:B})=>B.borderRadius};
  font-size: ${12/16}rem;
  font-weight: bold;
`,ae=()=>{const B=(0,i.useNotification)(),{lockApp:Z,unlockApp:j}=(0,i.useOverlayBlocker)(),{formatMessage:A}=(0,E.useIntl)(),[q,X]=(0,e.useState)(!1),{replace:te}=(0,pe.useHistory)(),w=(0,e.useRef)(),{trackUsage:oe}=(0,i.useTracking)(),Ee=(0,pe.useRouteMatch)("/settings/roles/duplicate/:id"),g=W()(Ee,"params.id",null),{isLoading:xe,data:ne}=(0,ge.U_)(),{permissions:Ae,isLoading:fe}=(0,ge.Dq)(g),ye=K=>{Z(),X(!0),oe(g?"willDuplicateRole":"willCreateNewRole"),Promise.resolve((0,i.request)("/admin/roles",{method:"POST",body:K})).then(async O=>{const{permissionsToSend:M}=w.current.getPermissions();return oe(g?"didDuplicateRole":"didCreateNewRole"),O.data.id&&!L()(M)&&await(0,i.request)(`/admin/roles/${O.data.id}/permissions`,{method:"PUT",body:{permissions:M}}),O}).then(O=>{X(!1),B({type:"success",message:{id:"Settings.roles.created",defaultMessage:"created"}}),te(`/settings/roles/${O.data.id}`)}).catch(O=>{console.error(O),X(!1),B({type:"warning",message:{id:"notification.error"}})}).finally(()=>{j()})},he=`${A({id:"Settings.roles.form.created",defaultMessage:"Created"})} ${(0,P.format)(new Date,"PPP")}`;return e.createElement(C.Main,null,e.createElement(i.SettingsPageTitle,{name:"Roles"}),e.createElement(D.Formik,{initialValues:{name:"",description:he},onSubmit:ye,validationSchema:ee,validateOnChange:!1},({handleSubmit:K,values:O,errors:M,handleReset:le,handleChange:se})=>e.createElement(i.Form,{noValidate:!0},e.createElement(e.Fragment,null,e.createElement(C.HeaderLayout,{primaryAction:e.createElement(C.Flex,{gap:2},e.createElement(C.Button,{variant:"secondary",onClick:()=>{le(),w.current.resetForm()},size:"L"},A({id:"app.components.Button.reset",defaultMessage:"Reset"})),e.createElement(C.Button,{onClick:K,loading:q,size:"L"},A({id:"global.save",defaultMessage:"Save"}))),title:A({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:A({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(i.Link,{startIcon:e.createElement(l.ArrowLeft,null),to:"/settings/roles"},A({id:"global.back",defaultMessage:"Back"}))}),e.createElement(C.ContentLayout,null,e.createElement(C.Flex,{direction:"column",alignItems:"stretch",gap:6},e.createElement(C.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(C.Flex,{direction:"column",alignItems:"stretch",gap:4},e.createElement(C.Flex,{justifyContent:"space-between"},e.createElement(C.Box,null,e.createElement(C.Box,null,e.createElement(C.Typography,{fontWeight:"bold"},A({id:"global.details",defaultMessage:"Details"}))),e.createElement(C.Box,null,e.createElement(C.Typography,{variant:"pi",textColor:"neutral600"},A({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(Se,null,A({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:0}))),e.createElement(C.Grid,{gap:4},e.createElement(C.GridItem,{col:6},e.createElement(C.TextInput,{name:"name",error:M.name&&A({id:M.name}),label:A({id:"global.name",defaultMessage:"Name"}),onChange:se,value:O.name})),e.createElement(C.GridItem,{col:6},e.createElement(C.Textarea,{label:A({id:"global.description",defaultMessage:"Description"}),name:"description",error:M.description&&A({id:M.description}),onChange:se},O.description))))),!xe&&!fe?e.createElement(C.Box,{shadow:"filterShadow",hasRadius:!0},e.createElement(_.Z,{isFormDisabled:!1,ref:w,permissions:Ae,layout:ne})):e.createElement(C.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(i.LoadingIndicatorPage,null))))))))};function ce(){return e.createElement(i.CheckPagePermissions,{permissions:G.Z.settings.roles.create},e.createElement(ae,null))}},18280:(z,U,u)=>{"use strict";u.d(U,{Z:()=>Tn});var e=u(67294),P=u(45697),i=u.n(P),C=u(95489),l=u(28702),D=u(18721),V=u.n(D),W=u(41609),J=u.n(W),L=u(97132),E=u(27821),pe=u(89734),Q=u.n(pe),_=u(41363),ge=u(27361),G=u.n(ge),re=u(57557),ke=u.n(re),ee=u(48474);const Se=E.default.div`
  position: relative;

  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: -3px;
      left: -10px;
      width: 6px;
      height: 6px;
      border-radius: ${20/16}rem;;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,ae=({onClick:t,className:n,hasConditions:o,variant:s})=>{const{formatMessage:r}=(0,L.useIntl)();return e.createElement(Se,{hasConditions:o,className:n},e.createElement(l.Button,{variant:s,startIcon:e.createElement(_.Cog,null),onClick:t},r({id:"global.settings",defaultMessage:"Settings"})))};ae.defaultProps={className:null,hasConditions:!1,variant:"tertiary"},ae.propTypes={onClick:i().func.isRequired,className:i().string,hasConditions:i().bool,variant:i().string};const ce=(0,E.default)(ae)``;var B=u(18172),Z=u(7739),j=u.n(Z),A=u(11700),q=u.n(A);const X=t=>Object.values(t).map(n=>Object.entries(n).filter(([,o])=>o).map(([o])=>o)).flat(),te=t=>t.reduce((n,[o,s])=>(n.push({label:q()(o),children:s.map(r=>({label:r.displayName,value:r.id}))}),n),[]),w=(t,n)=>t.map(([,o])=>o).flat().reduce((o,s)=>({[s.id]:n.includes(s.id),...o}),{}),oe=({arrayOfOptionsGroupedByCategory:t,isFormDisabled:n,isGrey:o,label:s,name:r,onChange:a,value:c})=>{const{formatMessage:d}=(0,L.useIntl)(),p=m=>{a(r,w(t,m))};return e.createElement(l.Flex,{as:"li",background:o?"neutral100":"neutral0",paddingBottom:3,paddingTop:3},e.createElement(l.Flex,{paddingLeft:6,style:{width:180}},e.createElement(l.Typography,{variant:"sigma",textColor:"neutral600"},d({id:"Settings.permissions.conditions.can",defaultMessage:"Can"}),"\xA0"),e.createElement(l.Typography,{variant:"sigma",title:s,textColor:"primary600",ellipsis:!0},d({id:`Settings.roles.form.permissions.${s.toLowerCase()}`,defaultMessage:s})),e.createElement(l.Typography,{variant:"sigma",textColor:"neutral600"},"\xA0",d({id:"Settings.permissions.conditions.when",defaultMessage:"When"}))),e.createElement(l.Box,{style:{maxWidth:430,width:"100%"}},e.createElement(l.MultiSelectNested,{id:r,customizeContent:m=>`${m.length} currently selected`,onChange:p,value:X(c),options:te(t),disabled:n})))};oe.propTypes={arrayOfOptionsGroupedByCategory:i().array.isRequired,isFormDisabled:i().bool.isRequired,isGrey:i().bool.isRequired,label:i().string.isRequired,name:i().string.isRequired,value:i().object.isRequired,onChange:i().func.isRequired};const Ee=oe;var g=u(96486);const xe=(t,n)=>t.reduce((o,s)=>(o[s.id]=(0,g.get)(n,s.id,!1),o),{}),ne=(t,n)=>t.reduce((o,s)=>{const[r,a]=s,c=xe(a,n);return o[r]=c,o},{}),fe=(t,n,o)=>t.reduce((s,r)=>{const a=(0,g.get)(n,[...r.pathToConditionsObject,"conditions"],{}),c=ne(o,a);return s[r.pathToConditionsObject.join("..")]=c,s},{}),ye=({actions:t,headerBreadCrumbs:n,isFormDisabled:o,onClosed:s,onToggle:r})=>{const{formatMessage:a}=(0,L.useIntl)(),{availableConditions:c,modifiedData:d,onChangeConditions:p}=(0,ee.$_)(),m=(0,e.useMemo)(()=>Object.entries(j()(c,"category")),[c]),f=t.filter(({isDisplayed:y,hasSomeActionsSelected:T,hasAllActionsSelected:v})=>y&&(T||v)),h=(0,e.useMemo)(()=>fe(f,d,m),[f,d,m]),[x,k]=(0,e.useState)(h),R=(y,T)=>{k((0,B.default)(v=>{v[y]||(v[y]={}),v[y].default||(v[y].default={}),v[y].default=T}))},b=()=>{const y=Object.entries(x).reduce((T,v)=>{const[S,N]=v,F=Object.values(N).reduce((I,$)=>({...I,...$}),{});return T[S]=F,T},{});p(y),r()};return e.createElement(l.ModalLayout,{labelledBy:"condition-modal-breadcrumbs",onClose:s},e.createElement(l.ModalHeader,null,e.createElement(l.Breadcrumbs,{id:"condition-modal-breadcrumbs",label:n.join(", ")},n.map(y=>e.createElement(l.Crumb,{key:y},q()(a({id:y,defaultMessage:y})))))),e.createElement(l.ModalBody,null,f.length===0&&e.createElement(l.Typography,null,a({id:"Settings.permissions.conditions.no-actions",defaultMessage:"You first need to select actions (create, read, update, ...) before defining conditions on them."})),e.createElement("ul",null,f.map(({actionId:y,label:T,pathToConditionsObject:v},S)=>{const N=v.join("..");return e.createElement(Ee,{key:y,arrayOfOptionsGroupedByCategory:m,label:T,isFormDisabled:o,isGrey:S%2===0,name:N,onChange:R,value:G()(x,N,{})})}))),e.createElement(l.ModalFooter,{startActions:e.createElement(l.Button,{variant:"tertiary",onClick:r},a({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(l.Button,{onClick:b},a({id:"Settings.permissions.conditions.apply",defaultMessage:"Apply"}))}))};ye.propTypes={actions:i().arrayOf(i().shape({actionId:i().string.isRequired,checkboxName:i().string,hasSomeActionsSelected:i().bool.isRequired,hasAllActionsSelected:i().bool,isDisplayed:i().bool.isRequired,label:i().string})).isRequired,headerBreadCrumbs:i().arrayOf(i().string).isRequired,isFormDisabled:i().bool.isRequired,onClosed:i().func.isRequired,onToggle:i().func.isRequired};const he=ye,K=`${120/16}rem`,O=`${200/16}rem`,M=`${53/16}rem`,se=E.default.div`
  width: ${K};
`,Ge=(0,E.default)(l.Flex)`
  padding-right: ${({theme:t})=>t.spaces[2]};
  overflow: hidden;
  flex: 1;
  ${({isCollapsable:t})=>t&&"cursor: pointer;"}
`,Oe=({children:t,isCollapsable:n,isActive:o,isFormDisabled:s,label:r,onChange:a,onClick:c,checkboxName:d,someChecked:p,value:m})=>{const{formatMessage:f}=(0,L.useIntl)();return e.createElement(l.Flex,{alignItems:"center",paddingLeft:6,style:{width:O,flexShrink:0}},e.createElement(l.Box,{paddingRight:2},e.createElement(l.BaseCheckbox,{name:d,"aria-label":f({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:r}),disabled:s,onValueChange:h=>a({target:{name:d,value:h}}),indeterminate:p,value:m})),e.createElement(Ge,{title:r,alignItems:"center",isCollapsable:n,...n&&{onClick:c,"aria-expanded":o,onKeyDown:({key:h})=>(h==="Enter"||h===" ")&&c(),tabIndex:0,role:"button"}},e.createElement(l.Typography,{fontWeight:o?"bold":"",textColor:o?"primary600":"neutral800",ellipsis:!0},q()(r)),t))};Oe.defaultProps={children:null,checkboxName:"",onChange(){},value:!1,someChecked:!1,isCollapsable:!1},Oe.propTypes={checkboxName:i().string,children:i().node,label:i().string.isRequired,isCollapsable:i().bool,isFormDisabled:i().bool.isRequired,onChange:i().func,onClick:i().func.isRequired,someChecked:i().bool,value:i().bool,isActive:i().bool.isRequired};const He=(0,e.memo)(Oe),We=t=>(0,g.isObject)(t)?(0,g.flattenDeep)(Object.values(t).map(n=>(0,g.isObject)(n)?We(n):n)):[],Ce=We,$e=t=>t?Object.keys(t).reduce((n,o)=>(o!=="conditions"&&(n[o]=t[o]),n),{}):null,de=t=>{const n=$e(t),o=Ce(n);if(!o.length)return{hasAllActionsSelected:!1,hasSomeActionsSelected:!1};const s=o.every(a=>a),r=o.some(a=>a)&&!s;return{hasAllActionsSelected:s,hasSomeActionsSelected:r}},xt=(t,n,o)=>t.map(({actionId:s,isDisplayed:r,applyToProperties:a,label:c})=>{if(!r)return{actionId:s,hasSomeActionsSelected:!1,isDisplayed:r};const d=[...o.split(".."),s],p=(0,g.isEmpty)(a)?[...d,"properties","enabled"]:d,m=p.join(".."),f=(0,g.get)(n,[...d,"conditions"],null),h=Ce(f).some(b=>b);if((0,g.isEmpty)(a)){const b=(0,g.get)(n,p,!1);return{actionId:s,checkboxName:m,hasAllActionsSelected:b,hasConditions:h,hasSomeActionsSelected:b,isDisplayed:r,isParentCheckbox:!1,label:c,pathToConditionsObject:d}}const x=(0,g.get)(n,p,null),{hasAllActionsSelected:k,hasSomeActionsSelected:R}=de(x);return{actionId:s,checkboxName:m,hasAllActionsSelected:k,hasConditions:h,hasSomeActionsSelected:R,isDisplayed:r,isParentCheckbox:!0,label:c,pathToConditionsObject:d}}),Re=(0,E.default)(_.CarretDown)`
  display: none;
  width: ${10/16}rem;
  transform: rotate(${({$isActive:t})=>t?"180":"0"}deg);
  margin-left: ${({theme:t})=>t.spaces[2]};
`,ve=t=>`
  ${l.Typography} {
    color: ${t.colors.primary600};
    font-weight: ${t.fontWeights.bold}
  }
  ${Re} {
    display: block;
    path {
      fill: ${t.colors.primary600}
    };
  }
`,Me=(t,n)=>`
  ${Ke} {
    background-color: ${t.colors.primary100};
    color: ${t.colors.primary600};
    border-radius: ${n?"2px 2px 0 0":"2px"};
  }
  ${Ze} {
    display: flex;
  }
  ${ce} {
    display: block;
  }
  &:hover {
   ${ve(t)}
  }

  &:focus-within {
    ${({theme:o,isActive:s})=>Me(o,s)}
  }
  
`,Ke=E.default.div`
  flex: 1;
  display: flex;
  align-items: center;
  height: ${M};
  background-color: ${({isGrey:t,theme:n})=>t?n.colors.neutral100:n.colors.neutral0};
  border: 1px solid transparent;
`,Rt=E.default.div`
  display: inline-flex;
  min-width: 100%;

  ${ce} {
    display: none;
  }
  ${({isActive:t,theme:n})=>t&&Me(n,t)}
  &:hover {
    ${({theme:t,isActive:n})=>Me(t,n)}
  }
`,Ue=(0,E.default)(l.Flex)`
  width: ${K};
  position: relative;
`,Ze=(0,E.default)(l.Box)`
  display: none;
  svg {
    width: 11px;
  }
  * {
    fill: ${({theme:t})=>t.colors.primary600};
  }
`,Xe=E.default.span`
  position: absolute;
  top: -6px;
  left: 37px;
  width: 6px;
  height: 6px;
  border-radius: 20px;
  background: ${({theme:t})=>t.colors.primary600};
`,vt=(0,E.default)(l.Box)`
  position: absolute;
  right: 9px;
  transform: translateY(10px);
`,Ye=({availableActions:t,isActive:n,isGrey:o,isFormDisabled:s,label:r,onClickToggle:a,pathToData:c})=>{const[d,p]=(0,e.useState)(!1),{formatMessage:m}=(0,L.useIntl)(),{modifiedData:f,onChangeParentCheckbox:h,onChangeSimpleCheckbox:x}=(0,ee.$_)(),k=()=>{p(F=>!F)},R=()=>{p(!1)},b=G()(f,c.split(".."),{}),y=(0,e.useMemo)(()=>Object.keys(b).reduce((F,I)=>(F[I]=ke()(b[I],"conditions"),F),{}),[b]),{hasAllActionsSelected:T,hasSomeActionsSelected:v}=de(y),S=(0,e.useMemo)(()=>xt(t,f,c),[t,f,c]),N=S.some(({hasConditions:F})=>F);return e.createElement(Rt,{isActive:n},e.createElement(Ke,{isGrey:o},e.createElement(He,{isCollapsable:!0,isFormDisabled:s,label:r,checkboxName:c,onChange:h,onClick:a,someChecked:v,value:T,isActive:n},e.createElement(Ze,{paddingLeft:2},n?e.createElement(_.ChevronUp,null):e.createElement(_.ChevronDown,null))),e.createElement(l.Flex,{style:{flex:1}},S.map(({actionId:F,hasConditions:I,hasAllActionsSelected:$,hasSomeActionsSelected:Y,isDisplayed:be,isParentCheckbox:H,checkboxName:ie,label:Te})=>be?H?e.createElement(Ue,{key:F,justifyContent:"center",alignItems:"center"},I&&e.createElement(Xe,null),e.createElement(l.BaseCheckbox,{disabled:s,name:ie,"aria-label":m({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${Te} ${r}`}),onValueChange:ue=>{h({target:{name:ie,value:ue}})},indeterminate:Y,value:$})):e.createElement(Ue,{key:F,justifyContent:"center",alignItems:"center"},I&&e.createElement(Xe,null),e.createElement(l.BaseCheckbox,{disabled:s,indeterminate:I,name:ie,onValueChange:ue=>{x({target:{name:ie,value:ue}})},value:$})):e.createElement(se,{key:F}))),d&&e.createElement(he,{headerBreadCrumbs:[r,"Settings.permissions.conditions.conditions"],actions:S,isFormDisabled:s,onClosed:R,onToggle:k})),e.createElement(vt,null,e.createElement(ce,{onClick:k,hasConditions:N})))};Ye.propTypes={availableActions:i().array.isRequired,isActive:i().bool.isRequired,isGrey:i().bool.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,onClickToggle:i().func.isRequired,pathToData:i().string.isRequired};const Tt=Ye,St=(t,n)=>t.map(o=>{const s=Array.isArray(o.applyToProperties)&&o.applyToProperties.indexOf(n)!==-1&&o.isDisplayed;return{label:o.label,actionId:o.actionId,isActionRelatedToCurrentProperty:s}}),ze=(0,E.default)(l.Flex)`
  width: ${K};
  flex-shrink: 0;
`,At=(0,E.default)(l.Flex)`
  width: ${O};
  height: ${M};
  flex-shrink: 0;
`,Je=({headers:t,label:n})=>{const{formatMessage:o}=(0,L.useIntl)(),s=o({id:"Settings.roles.form.permission.property-label",defaultMessage:"{label} permissions"},{label:n});return e.createElement(l.Flex,null,e.createElement(At,{alignItems:"center",paddingLeft:6},e.createElement(l.Typography,{variant:"sigma",textColor:"neutral500"},s)),t.map(r=>r.isActionRelatedToCurrentProperty?e.createElement(ze,{justifyContent:"center",key:r.label},e.createElement(l.Typography,{variant:"sigma",textColor:"neutral500"},o({id:`Settings.roles.form.permissions.${r.label.toLowerCase()}`,defaultMessage:r.label}))):e.createElement(ze,{key:r.label})))};Je.propTypes={headers:i().arrayOf(i().shape({label:i().string.isRequired,isActionRelatedToCurrentProperty:i().bool.isRequired})).isRequired,label:i().string.isRequired};const Pt=Je,kt=E.default.span`
  color: ${({theme:t})=>t.colors.danger700};
  padding-left: ${({theme:t})=>t.spaces[1]}px;
`,Qe=()=>e.createElement(kt,null,"*"),Ot=(t,n)=>t.map(o=>{const s=Array.isArray(o.subjects)&&o.subjects.indexOf(n)!==-1;return{...o,isDisplayed:s}}),$t=(0,E.default)(l.Box)`
  transform: translate(-4px, -12px);

  &:before {
    content: '';
    width: ${4/16}rem;
    height: ${12/16}rem;
    background: ${({theme:t})=>t.colors.primary200};
    display: block;
  }
`,Mt=E.default.svg`
  position: relative;
  flex-shrink: 0;
  transform: translate(-0.5px, -1px);

  * {
    fill: ${({theme:t,color:n})=>t.colors[n]};
  }
`,Fe=t=>e.createElement($t,null,e.createElement(Mt,{width:"20",height:"23",viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.02477 14.7513C8.65865 17.0594 11.6046 18.6059 17.5596 18.8856C18.6836 18.9384 19.5976 19.8435 19.5976 20.9688V20.9688C19.5976 22.0941 18.6841 23.0125 17.5599 22.9643C10.9409 22.6805 6.454 20.9387 3.75496 17.1258C0.937988 13.1464 0.486328 7.39309 0.486328 0.593262H4.50974C4.50974 7.54693 5.06394 11.9813 7.02477 14.7513Z",fill:"#D9D8FF"})));Fe.defaultProps={fill:"primary200"},Fe.propTypes={fill:i().string};const Ft=(0,e.memo)(Fe),_e=(0,E.default)(l.Flex)`
  width: ${K};
  position: relative;
`,Lt=(0,E.default)(l.Flex)`
  height: ${M};
`,Bt=(0,E.default)(l.Box)`
  padding-left: ${31/16}rem;
`,jt=(0,E.default)(l.Box)`
  border-left: ${({isVisible:t,theme:n})=>t?`4px solid ${n.colors.primary200}`:"4px solid transparent"};
`,Dt=(0,E.default)(l.Flex)`
  padding-left: ${({theme:t})=>t.spaces[4]};
  width: ${({level:t})=>145-t*36}px;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Re} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${ve(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&ve(n)};
`,It=E.default.div`
  padding-top: ${({theme:t})=>t.spaces[2]};
  margin-top: ${({theme:t})=>t.spaces[2]};
  width: ${4/16}rem;
  background-color: ${({theme:t})=>t.colors.primary200};
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
`,Le=({childrenForm:t,isFormDisabled:n,recursiveLevel:o,pathToDataFromActionRow:s,propertyActions:r,parentName:a,propertyName:c})=>{const{formatMessage:d}=(0,L.useIntl)(),{modifiedData:p,onChangeParentCheckbox:m,onChangeSimpleCheckbox:f}=(0,ee.$_)(),[h,x]=(0,e.useState)(null),k=b=>{x(y=>y===b?null:b)},R=(0,e.useMemo)(()=>h?t.find(({value:b})=>b===h):null,[h,t]);return e.createElement(Bt,null,e.createElement(It,null),t.map(({label:b,value:y,required:T,children:v},S)=>{const N=S+1<t.length,F=Array.isArray(v),I=h===y;return e.createElement(jt,{key:y,isVisible:N},e.createElement(Lt,null,e.createElement(Ft,{color:"primary200"}),e.createElement(l.Flex,{style:{flex:1}},e.createElement(Dt,{level:o,isActive:I,isCollapsable:F},e.createElement(Ge,{alignItems:"center",isCollapsable:F,...F&&{onClick:()=>k(y),"aria-expanded":I,onKeyDown:({key:$})=>($==="Enter"||$===" ")&&k(y),tabIndex:0,role:"button"},title:b},e.createElement(l.Typography,{ellipsis:!0},q()(b)),T&&e.createElement(Qe,null),e.createElement(Re,{$isActive:I}))),e.createElement(l.Flex,{style:{flex:1}},r.map(({actionId:$,label:Y,isActionRelatedToCurrentProperty:be})=>{if(!be)return e.createElement(se,{key:$});const H=[...s.split(".."),$,"properties",c,...a.split(".."),y],ie=G()(p,H,!1);if(!v)return e.createElement(_e,{key:Y,justifyContent:"center",alignItems:"center"},e.createElement(l.BaseCheckbox,{disabled:n,name:H.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${a} ${b} ${Y}`}),onValueChange:me=>{f({target:{name:H.join(".."),value:me}})},value:ie}));const{hasAllActionsSelected:Te,hasSomeActionsSelected:ue}=de(ie);return e.createElement(_e,{key:Y,justifyContent:"center",alignItems:"center"},e.createElement(l.BaseCheckbox,{key:Y,disabled:n,name:H.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${a} ${b} ${Y}`}),onValueChange:me=>{m({target:{name:H.join(".."),value:me}})},value:Te,indeterminate:ue}))})))),R&&I&&e.createElement(l.Box,{paddingBottom:2},e.createElement(Le,{isFormDisabled:n,parentName:`${a}..${y}`,pathToDataFromActionRow:s,propertyActions:r,propertyName:c,recursiveLevel:o+1,childrenForm:R.children})))}))};Le.propTypes={childrenForm:i().array.isRequired,isFormDisabled:i().bool.isRequired,parentName:i().string.isRequired,pathToDataFromActionRow:i().string.isRequired,propertyActions:i().array.isRequired,propertyName:i().string.isRequired,recursiveLevel:i().number.isRequired};const qt=(0,e.memo)(Le),wt=t=>t.reduce((o,s)=>(s.isActionRelatedToCurrentProperty&&o.push(s.actionId),o),[]),Nt=(t,n,o,s,r)=>{const c=wt(t).reduce((d,p)=>{const m=[...o.split(".."),p,"properties",s,r],f=(0,g.get)(n,m,!1);return d[p]=f,d},{});return de(c)},et=(0,E.default)(l.Flex)`
  width: ${K};
  position: relative;
`,Vt=(0,E.default)(l.Flex)`
  height: ${M};
  flex: 1;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Re} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${ve(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&ve(n)};
`,Be=({childrenForm:t,label:n,isFormDisabled:o,name:s,required:r,pathToData:a,propertyActions:c,propertyName:d,isOdd:p})=>{const{formatMessage:m}=(0,L.useIntl)(),[f,h]=(0,e.useState)(null),{modifiedData:x,onChangeCollectionTypeLeftActionRowCheckbox:k,onChangeParentCheckbox:R,onChangeSimpleCheckbox:b}=(0,ee.$_)(),y=f===s,T=(0,e.useMemo)(()=>Array.isArray(t)?t:[],[t]),v=T.length>0,S=(0,e.useCallback)(()=>{v&&h($=>$===s?null:s)},[v,s]),N=({target:{value:$}})=>{k(a,d,s,$)},{hasAllActionsSelected:F,hasSomeActionsSelected:I}=(0,e.useMemo)(()=>Nt(c,x,a,d,s),[c,x,a,d,s]);return e.createElement(e.Fragment,null,e.createElement(Vt,{alignItems:"center",isCollapsable:v,isActive:y,background:p?"neutral100":"neutral0"},e.createElement(l.Flex,null,e.createElement(He,{onChange:N,onClick:S,isCollapsable:v,isFormDisabled:o,label:n,someChecked:I,value:F,isActive:y},r&&e.createElement(Qe,null),e.createElement(Re,{$isActive:y})),e.createElement(l.Flex,null,c.map(({label:$,isActionRelatedToCurrentProperty:Y,actionId:be})=>{if(!Y)return e.createElement(se,{key:$});const H=[...a.split(".."),be,"properties",d,s];if(!v){const me=G()(x,H,!1);return e.createElement(et,{key:be,justifyContent:"center",alignItems:"center"},e.createElement(l.BaseCheckbox,{disabled:o,name:H.join(".."),"aria-label":m({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${$}`}),onValueChange:Sn=>{b({target:{name:H.join(".."),value:Sn}})},value:me}))}const ie=G()(x,H,{}),{hasAllActionsSelected:Te,hasSomeActionsSelected:ue}=de(ie);return e.createElement(et,{key:$,justifyContent:"center",alignItems:"center"},e.createElement(l.BaseCheckbox,{disabled:o,name:H.join(".."),onValueChange:me=>{R({target:{name:H.join(".."),value:me}})},"aria-label":m({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${$}`}),value:Te,indeterminate:ue}))})))),y&&e.createElement(qt,{childrenForm:T,isFormDisabled:o,parentName:s,pathToDataFromActionRow:a,propertyName:d,propertyActions:c,recursiveLevel:0}))};Be.defaultProps={childrenForm:[],required:!1},Be.propTypes={childrenForm:i().array,label:i().string.isRequired,isFormDisabled:i().bool.isRequired,name:i().string.isRequired,pathToData:i().string.isRequired,propertyActions:i().array.isRequired,propertyName:i().string.isRequired,required:i().bool,isOdd:i().bool.isRequired};const Gt=(0,e.memo)(Be),Ht=E.default.div`
  display: inline-flex;
  flex-direction: column;
  min-width: 0;
`,tt=({availableActions:t,childrenForm:n,isFormDisabled:o,label:s,pathToData:r,propertyName:a})=>{const c=(0,e.useMemo)(()=>St(t,a),[t,a]);return e.createElement(Ht,null,e.createElement(Pt,{label:s,headers:c}),e.createElement(l.Box,null,n.map(({children:d,label:p,value:m,required:f},h)=>e.createElement(Gt,{childrenForm:d,key:m,label:p,isFormDisabled:o,name:m,required:f,propertyActions:c,pathToData:r,propertyName:a,isOdd:h%2===0}))))};tt.propTypes={childrenForm:i().array.isRequired,availableActions:i().array.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,pathToData:i().string.isRequired,propertyName:i().string.isRequired};const Wt=tt,Kt=E.default.div`
  flex-direction: column;
  display: inline-flex;
  min-width: 100%;
  ${({theme:t,isActive:n})=>n&&`border: 1px solid ${t.colors.primary600};`}
`,nt=({allActions:t,contentTypeName:n,label:o,index:s,isActive:r,isFormDisabled:a,onClickToggleCollapse:c,pathToData:d,properties:p})=>{const m=(0,e.useCallback)(()=>{c(n)},[n,c]),f=(0,e.useMemo)(()=>Ot(t,n),[t,n]);return e.createElement(Kt,{isActive:r},e.createElement(Tt,{availableActions:f,isActive:r,isGrey:s%2===0,isFormDisabled:a,label:o,onClickToggle:m,pathToData:d}),r&&p.map(({label:h,value:x,children:k})=>e.createElement(Wt,{availableActions:f,childrenForm:k,isFormDisabled:a,label:h,pathToData:d,propertyName:x,key:x})))};nt.propTypes={allActions:i().array.isRequired,contentTypeName:i().string.isRequired,index:i().number.isRequired,isActive:i().bool.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,onClickToggleCollapse:i().func.isRequired,pathToData:i().string.isRequired,properties:i().array.isRequired};const Ut=nt,je=({actions:t,isFormDisabled:n,pathToData:o,subjects:s})=>{const[r,a]=(0,e.useState)(null),c=d=>{a(r===d?null:d)};return s.map(({uid:d,label:p,properties:m},f)=>e.createElement(Ut,{allActions:t,key:d,contentTypeName:d,label:p,isActive:r===d,isFormDisabled:n,index:f,onClickToggleCollapse:c,pathToData:`${o}..${d}`,properties:m}))};je.defaultProps={actions:[],subjects:[]},je.propTypes={actions:i().array.isRequired,isFormDisabled:i().bool.isRequired,pathToData:i().string.isRequired,subjects:i().arrayOf(i().shape({uid:i().string.isRequired,label:i().string.isRequired,properties:i().array.isRequired}))};const Zt=(0,e.memo)(je),Xt=t=>t.filter(({subjects:n})=>n&&n.length),Yt=t=>t.map(({actionId:n})=>n),zt=(t,n)=>t.reduce((o,s)=>(Object.keys(n).forEach(r=>{const a=(0,g.get)(n,[r,s],{}),c={[r]:$e(a)};o[s]?o[s]={...o[s],...c}:o[s]=c}),o),{}),Jt=(t,n)=>{const o=Yt(t),s=zt(o,n);return Object.keys(s).reduce((a,c)=>(a[c]=de(s[c]),a),{})},Qt=(0,E.default)(l.Flex)`
  width: ${K};
  flex-shrink: 0;
`,De=({actions:t,isFormDisabled:n,kind:o})=>{const{formatMessage:s}=(0,L.useIntl)(),{modifiedData:r,onChangeCollectionTypeGlobalActionCheckbox:a}=(0,ee.$_)(),c=(0,e.useMemo)(()=>Xt(t),[t]),d=(0,e.useMemo)(()=>Jt(c,r[o]),[r,c,o]);return e.createElement(l.Box,{paddingBottom:4,paddingTop:6,style:{paddingLeft:O}},e.createElement(l.Flex,{gap:0},c.map(({label:p,actionId:m})=>e.createElement(Qt,{direction:"column",alignItems:"center",justifyContent:"center",key:m,gap:3},e.createElement(l.Typography,{variant:"sigma",textColor:"neutral500"},s({id:`Settings.roles.form.permissions.${p.toLowerCase()}`,defaultMessage:p})),e.createElement(l.BaseCheckbox,{disabled:n,onValueChange:f=>{a(o,m,f)},name:m,"aria-label":s({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:s({id:`Settings.roles.form.permissions.${p.toLowerCase()}`,defaultMessage:p})}),value:G()(d,[m,"hasAllActionsSelected"],!1),indeterminate:G()(d,[m,"hasSomeActionsSelected"],!1)})))))};De.defaultProps={actions:[]},De.propTypes={actions:i().arrayOf(i().shape({label:i().string.isRequired,actionId:i().string.isRequired,subjects:i().array.isRequired})),isFormDisabled:i().bool.isRequired,kind:i().string.isRequired};const _t=(0,e.memo)(De),en=(0,E.default)(l.Box)`
  overflow-x: auto;
`,st=({isFormDisabled:t,kind:n,layout:{actions:o,subjects:s}})=>{const r=Q()([...s],"label");return e.createElement(en,{background:"neutral0"},e.createElement(_t,{actions:o,kind:n,isFormDisabled:t}),e.createElement(Zt,{actions:o,isFormDisabled:t,pathToData:n,subjects:r}))};st.propTypes={isFormDisabled:i().bool.isRequired,kind:i().string.isRequired,layout:i().shape({actions:i().array,subjects:i().arrayOf(i().shape({uid:i().string.isRequired,label:i().string.isRequired,properties:i().array.isRequired}))}).isRequired};const ot=(0,e.memo)(st);var tn=u(47713);const it=({children:t,value:n})=>e.createElement(tn.$l.Provider,{value:n},t);it.propTypes={children:i().node.isRequired,value:i().exact({availableConditions:i().array.isRequired,modifiedData:i().object.isRequired,onChangeCollectionTypeLeftActionRowCheckbox:i().func.isRequired,onChangeConditions:i().func.isRequired,onChangeSimpleCheckbox:i().func.isRequired,onChangeParentCheckbox:i().func.isRequired,onChangeCollectionTypeGlobalActionCheckbox:i().func.isRequired}).isRequired};const nn=it,sn=(t,n,o)=>t.map(s=>{const r=[...o,s.action,"properties","enabled"],a=(0,g.get)(n,r,!1),c=(0,g.get)(n,[...o,s.action,"conditions"],{}),d=Ce(c).some(p=>p);return{...s,isDisplayed:a,checkboxName:r.join(".."),hasSomeActionsSelected:a,value:a,hasConditions:d,label:s.displayName,actionId:s.action,pathToConditionsObject:[...o,s.action]}}),on=t=>{const n=Object.entries(t).reduce((s,r)=>{const[a,{conditions:c}]=r;return s[a]=c,s},{});return Ce(n).some(s=>s)},rn=E.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,an=E.default.div`
  position: relative;
  word-break: keep-all;
  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: ${-4/16}rem;
      left: ${-8/16}rem;
      width: ${6/16}rem;
      height: ${6/16}rem;
      border-radius: ${20/16}rem;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,rt=({categoryName:t,isFormDisabled:n,subCategoryName:o,actions:s,pathToData:r})=>{const[a,c]=(0,e.useState)(!1),{modifiedData:d,onChangeParentCheckbox:p,onChangeSimpleCheckbox:m}=(0,ee.$_)(),{formatMessage:f}=(0,L.useIntl)(),h=G()(d,r,{}),x=(0,e.useMemo)(()=>Object.keys(h).reduce((S,N)=>(S[N]=$e(h[N]),S),{}),[h]),{hasAllActionsSelected:k,hasSomeActionsSelected:R}=de(x),b=()=>{c(S=>!S)},y=()=>{c(!1)},T=sn(s,d,r),v=on(G()(d,[...r],{}));return e.createElement(e.Fragment,null,e.createElement(l.Box,null,e.createElement(l.Flex,{justifyContent:"space-between",alignItems:"center"},e.createElement(l.Box,{paddingRight:4},e.createElement(l.Typography,{variant:"sigma",textColor:"neutral600"},o)),e.createElement(rn,null),e.createElement(l.Box,{paddingLeft:4},e.createElement(l.Checkbox,{name:r.join(".."),disabled:n,onValueChange:S=>{p({target:{name:r.join(".."),value:S}})},indeterminate:R,value:k},f({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(l.Flex,{paddingTop:6,paddingBottom:6},e.createElement(l.Grid,{gap:2,style:{flex:1}},T.map(({checkboxName:S,value:N,action:F,displayName:I,hasConditions:$})=>e.createElement(l.GridItem,{col:3,key:F},e.createElement(an,{disabled:n,hasConditions:$},e.createElement(l.Checkbox,{name:S,disabled:n,onValueChange:Y=>{m({target:{name:S,value:Y}})},value:N},I))))),e.createElement(ce,{hasConditions:v,onClick:b}))),a&&e.createElement(he,{headerBreadCrumbs:[t,o],actions:T,isFormDisabled:n,onClosed:y,onToggle:b}))};rt.propTypes={actions:i().array.isRequired,categoryName:i().string.isRequired,isFormDisabled:i().bool.isRequired,subCategoryName:i().string.isRequired,pathToData:i().array.isRequired};const ln=rt,Ie=({childrenForm:t,kind:n,name:o,isOpen:s,isFormDisabled:r,isWhite:a,onOpenCategory:c,pathToData:d})=>{const{formatMessage:p}=(0,L.useIntl)(),m=()=>{c(o)},f=(0,e.useMemo)(()=>o.split("::").pop(),[o]);return e.createElement(l.Accordion,{expanded:s,onToggle:m,id:`accordion-${o}`,variant:a?"primary":"secondary"},e.createElement(l.AccordionToggle,{title:q()(f),description:`${p({id:"Settings.permissions.category"},{category:f})} ${n==="plugins"?"plugin":n}`}),e.createElement(l.AccordionContent,null,e.createElement(l.Box,{padding:6},t.map(({actions:h,subCategoryName:x,subCategoryId:k})=>e.createElement(ln,{key:x,actions:h,categoryName:f,isFormDisabled:r,subCategoryName:x,pathToData:[...d,k]})))))};Ie.defaultProps={},Ie.propTypes={childrenForm:i().array.isRequired,isOpen:i().bool.isRequired,isFormDisabled:i().bool.isRequired,isWhite:i().bool.isRequired,kind:i().string.isRequired,name:i().string.isRequired,onOpenCategory:i().func.isRequired,pathToData:i().array.isRequired};const cn=Ie,at=({isFormDisabled:t,kind:n,layout:o})=>{const[s,r]=(0,e.useState)(null),a=c=>{r(c===s?null:c)};return e.createElement(l.Box,{padding:6,background:"neutral0"},o.map(({category:c,categoryId:d,childrenForm:p},m)=>e.createElement(cn,{key:c,childrenForm:p,kind:n,isFormDisabled:t,isOpen:s===c,isWhite:m%2===1,name:c,onOpenCategory:a,pathToData:[n,d]})))};at.propTypes={isFormDisabled:i().bool.isRequired,kind:i().string.isRequired,layout:i().arrayOf(i().shape({category:i().string.isRequired,categoryId:i().string.isRequired,childrenForm:i().arrayOf(i().shape({actions:i().array.isRequired})).isRequired}).isRequired).isRequired};const lt=at,ct=(t,n,o)=>t.find(s=>s.action===n&&s.subject===o),dt=(t,n=[])=>t.reduce((o,s)=>(o[s.id]=n.indexOf(s.id)!==-1,o),{}),ut=({children:t},n,o="")=>t.reduce((s,r)=>{if(r.children)return{...s,[r.value]:ut(r,n,`${o}${r.value}.`)};const a=n.indexOf(`${o}${r.value}`)!==-1;return s[r.value]=a,s},{}),dn=(t,n,o)=>t.reduce((s,r)=>{const a=n.properties.find(({value:c})=>c===r);if(a){const c=(0,g.get)(o,["properties",a.value],[]),d=ut(a,c);s.properties[r]=d}return s},{properties:{}}),un=(t,n)=>n.reduce((o,s)=>{const r=t.find(({uid:a})=>a===s)||null;return r&&(o[s]=r),o},{}),mt=({subjects:t},n,o,s=[])=>n.reduce((r,a)=>{const c=a.subjects,d=un(t,c);if((0,g.isEmpty)(d))return r;const p=Object.keys(d).reduce((m,f)=>{const{actionId:h,applyToProperties:x}=a,b=d[f].properties.map(({value:S})=>S).every(S=>(x||[]).indexOf(S)===-1),y=ct(s,h,f),T=dt(o,(0,g.get)(y,"conditions",[]));if((0,g.isEmpty)(x)||b)return(0,g.set)(m,[f,h],{properties:{enabled:y!==void 0},conditions:T}),m;const v=dn(x,d[f],y);return(0,g.set)(m,[f,h],{...v,conditions:T}),m},{});return(0,g.merge)(r,p)},{}),mn=(t,n,o)=>t.reduce((s,r)=>{const a=ct(o,r.action,null);return s[r.action]={properties:{enabled:a!==void 0},conditions:dt(n,(0,g.get)(a,"conditions",[]))},s},{}),pn=(t,n,o)=>t.reduce((s,r)=>(s[r.subCategoryId]=mn(r.actions,n,o),s),{}),pt=(t,n,o=[])=>t.reduce((s,{categoryId:r,childrenForm:a})=>{const c=pn(a,n,o);return s[r]=c,s},{}),gt=t=>t.split(" ").join("-"),ft=(t,n)=>Object.entries(j()(t,n)).map(([o,s])=>({category:o,categoryId:gt(o),childrenForm:Object.entries(j()(s,"subCategory")).map(([r,a])=>({subCategoryName:r,subCategoryId:gt(r),actions:a}))})),gn=(t,n)=>{const{conditions:o,sections:{collectionTypes:s,singleTypes:r,plugins:a,settings:c}}=t,d={collectionTypes:s,singleTypes:r,plugins:ft(a,"plugin"),settings:ft(c,"category")},p={collectionTypes:mt(s,s.actions||[],o,n),singleTypes:mt(r,r.actions||[],o,n),plugins:pt(d.plugins,o,n),settings:pt(d.settings,o,n)};return{initialData:p,modifiedData:p,layouts:d}},yt=t=>Object.keys(t).reduce((n,o)=>{const s=t[o];if((0,g.isObject)(s)&&!(0,g.has)(s,"conditions"))return{...n,[o]:yt(s)};if((0,g.isObject)(s)&&(0,g.has)(s,"conditions")&&!Ce((0,g.omit)(s,"conditions")).some(a=>a)){const a=Object.keys(s.conditions).reduce((c,d)=>(c[d]=!1,c),{});return{...n,[o]:{...s,conditions:a}}}return n[o]=s,n},{}),qe=yt,ht=(t,n)=>Object.keys(t).reduce((o,s)=>{const r=t[s];return s==="conditions"?(o[s]=r,o):(0,g.isObject)(r)?{...o,[s]:ht(r,n)}:(o[s]=n,o)},{}),Pe=ht,fn={initialData:{},modifiedData:{},layouts:{}},yn=(t,n)=>(0,B.default)(t,o=>{switch(n.type){case"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX":{const{collectionTypeKind:s,actionId:r,value:a}=n,c=["modifiedData",s];Object.keys((0,g.get)(t,c)).forEach(d=>{const p=(0,g.get)(t,[...c,d,r],void 0);if(p){let m=Pe(p,a);if(!a&&m.conditions){const f=Pe(m.conditions,!1);m={...m,conditions:f}}(0,g.set)(o,[...c,d,r],m)}});break}case"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX":{const{pathToCollectionType:s,propertyName:r,rowName:a,value:c}=n;let d=(0,g.cloneDeep)(t.modifiedData);const p=s.split(".."),m=(0,g.get)(d,p,{});Object.keys(m).forEach(f=>{if((0,g.has)(m[f],`properties.${r}`)){const h=(0,g.get)(m,[f,"properties",r,a]),x=[...p,f,"properties",r,a];if(!(0,g.isObject)(h))(0,g.set)(d,x,c);else{const k=Pe(h,c);(0,g.set)(d,x,k)}}}),c||(d=qe(d)),(0,g.set)(o,"modifiedData",d);break}case"ON_CHANGE_CONDITIONS":{Object.entries(n.conditions).forEach(s=>{const[r,a]=s;(0,g.set)(o,["modifiedData",...r.split(".."),"conditions"],a)});break}case"ON_CHANGE_SIMPLE_CHECKBOX":{let s=(0,g.cloneDeep)(t.modifiedData);(0,g.set)(s,[...n.keys.split("..")],n.value),n.value||(s=qe(s)),(0,g.set)(o,"modifiedData",s);break}case"ON_CHANGE_TOGGLE_PARENT_CHECKBOX":{const{keys:s,value:r}=n,a=[...s.split("..")];let c=(0,g.cloneDeep)(t.modifiedData);const d=(0,g.get)(c,a,{}),p=Pe(d,r);(0,g.set)(c,a,p),r||(c=qe(c)),(0,g.set)(o,["modifiedData"],c);break}case"RESET_FORM":{o.modifiedData=t.initialData;break}case"SET_FORM_AFTER_SUBMIT":{o.initialData=t.modifiedData;break}default:return o}}),we=t=>Object.entries(t).filter(([,n])=>n).map(([n])=>n),hn=t=>{const[n,{conditions:o}]=t;return{action:n,subject:null,conditions:we(o),properties:{}}},Cn=t=>Object.values(t).reduce((n,o)=>{const s=Object.entries(o).reduce((r,a)=>{const[,{properties:{enabled:c}}]=a;if(!c)return r;const d=hn(a);return r.push(d),r},[]);return[...n,...s]},[]),Ct=t=>Object.values(t).reduce((n,o)=>{const s=Cn(o);return[...n,...s]},[]),bt=(t,n="")=>Object.entries(t).reduce((o,s)=>{const[r,a]=s;return(0,g.isObject)(a)?[...o,...bt(a,`${n}${r}.`)]:(a&&!(0,g.isObject)(a)&&o.push(`${n}${r}`),o)},[]),bn=(t,n,{conditions:o,properties:s})=>Object.entries(s).reduce((r,a)=>{const[c,d]=a;return r.properties[c]=bt(d),r},{action:t,subject:n,conditions:we(o),properties:{}}),En=(t,n,{conditions:o})=>({action:t,subject:n,properties:{},conditions:we(o)}),xn=(t,n)=>Object.entries(n).reduce((s,r)=>{const[a,c]=r;if(!Ce(c).some(m=>m))return s;if(!(0,g.has)(c,"properties.enabled")){const m=bn(a,t,c);return[...s,m]}if(!c.properties.enabled)return s;const p=En(a,t,c);return s.push(p),s},[]),Et=t=>Object.entries(t).reduce((o,s)=>{const[r,a]=s,c=xn(r,a);return[...o,...c]},[]),Rn=t=>{const n=Ct(t.plugins),o=Ct(t.settings),s=Et(t.collectionTypes),r=Et(t.singleTypes);return[...n,...o,...s,...r]},vn=[{labelId:"app.components.LeftMenuLinkContainer.collectionTypes",defaultMessage:"Collection Types",id:"collectionTypes"},{labelId:"app.components.LeftMenuLinkContainer.singleTypes",id:"singleTypes",defaultMessage:"Single Types"},{labelId:"app.components.LeftMenuLinkContainer.plugins",defaultMessage:"Plugins",id:"plugins"},{labelId:"app.components.LeftMenuLinkContainer.settings",defaultMessage:"Settings",id:"settings"}],Ne=(0,e.forwardRef)(({layout:t,isFormDisabled:n,permissions:o},s)=>{const[{initialData:r,layouts:a,modifiedData:c},d]=(0,e.useReducer)(yn,fn,()=>gn(t,o)),{formatMessage:p}=(0,L.useIntl)();(0,e.useImperativeHandle)(s,()=>({getPermissions(){const R=(0,C.difference)(r.collectionTypes,c.collectionTypes),b=(0,C.difference)(r.singleTypes,c.singleTypes),y={...R,...b};let T;return J()(y)?T=!1:T=Object.values(y).some(v=>Object.values(v).some(S=>V()(S,"conditions"))),{permissionsToSend:Rn(c),didUpdateConditions:T}},resetForm(){d({type:"RESET_FORM"})},setFormAfterSubmit(){d({type:"SET_FORM_AFTER_SUBMIT"})}}));const m=(R,b,y,T)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX",pathToCollectionType:R,propertyName:b,rowName:y,value:T})},f=(R,b,y)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX",collectionTypeKind:R,actionId:b,value:y})},h=R=>{d({type:"ON_CHANGE_CONDITIONS",conditions:R})},x=(0,e.useCallback)(({target:{name:R,value:b}})=>{d({type:"ON_CHANGE_SIMPLE_CHECKBOX",keys:R,value:b})},[]),k=(0,e.useCallback)(({target:{name:R,value:b}})=>{d({type:"ON_CHANGE_TOGGLE_PARENT_CHECKBOX",keys:R,value:b})},[]);return e.createElement(nn,{value:{availableConditions:t.conditions,modifiedData:c,onChangeConditions:h,onChangeSimpleCheckbox:x,onChangeParentCheckbox:k,onChangeCollectionTypeLeftActionRowCheckbox:m,onChangeCollectionTypeGlobalActionCheckbox:f}},e.createElement(l.TabGroup,{id:"tabs",label:p({id:"Settings.permissions.users.tabs.label",defaultMessage:"Tabs Permissions"})},e.createElement(l.Tabs,null,vn.map(R=>e.createElement(l.Tab,{key:R.id},p({id:R.labelId,defaultMessage:R.defaultMessage})))),e.createElement(l.TabPanels,{style:{position:"relative"}},e.createElement(l.TabPanel,null,e.createElement(ot,{layout:a.collectionTypes,kind:"collectionTypes",isFormDisabled:n})),e.createElement(l.TabPanel,null,e.createElement(ot,{layout:a.singleTypes,kind:"singleTypes",isFormDisabled:n})),e.createElement(l.TabPanel,null,e.createElement(lt,{layout:a.plugins,kind:"plugins",isFormDisabled:n})),e.createElement(l.TabPanel,null,e.createElement(lt,{layout:a.settings,kind:"settings",isFormDisabled:n})))))});Ne.defaultProps={permissions:[],layout:{conditions:[],sections:{collectionTypes:{},singleTypes:{actions:[]},settings:[],plugins:[]}}},Ne.propTypes={layout:i().object,isFormDisabled:i().bool.isRequired,permissions:i().array};const Tn=(0,e.memo)(Ne)},92100:(z,U,u)=>{"use strict";u.r(U),u.d(U,{default:()=>B});var e=u(67294),P=u(95489),i=u(49656),C=u(87751),l=u(28702),D=u(80831),V=u(41363),W=u(27361),J=u.n(W),L=u(97132),E=u(18280),pe=u(45697),Q=u.n(pe);const _=({disabled:Z,role:j,values:A,errors:q,onChange:X,onBlur:te})=>{const{formatMessage:w}=(0,L.useIntl)();return e.createElement(l.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(l.Flex,{direction:"column",alignItems:"stretch",gap:4},e.createElement(l.Flex,{justifyContent:"space-between"},e.createElement(l.Box,null,e.createElement(l.Box,null,e.createElement(l.Typography,{fontWeight:"bold"},j?j.name:w({id:"global.details",defaultMessage:"Details"}))),e.createElement(l.Box,null,e.createElement(l.Typography,{textColor:"neutral500",variant:"pi"},j?j.description:w({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(l.Button,{disabled:!0,variant:"secondary"},w({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:j.usersCount}))),e.createElement(l.Grid,{gap:4},e.createElement(l.GridItem,{col:6},e.createElement(l.TextInput,{disabled:Z,name:"name",error:q.name&&w({id:q.name}),label:w({id:"global.name",defaultMessage:"Name"}),onChange:X,onBlur:te,value:A.name||""})),e.createElement(l.GridItem,{col:6},e.createElement(l.Textarea,{disabled:Z,label:w({id:"global.description",defaultMessage:"Description"}),name:"description",error:q.name&&w({id:q.name}),onChange:X,onBlur:te},A.description||"")))))};_.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},_.propTypes={disabled:Q().bool,errors:Q().object.isRequired,onBlur:Q().func.isRequired,onChange:Q().func.isRequired,role:Q().object,values:Q().object};const ge=_;var G=u(48474),re=u(53209);const ee=re.Ry().shape({name:re.Z_().required(P.translatedErrors.required)}),ae=()=>{const Z=(0,P.useNotification)(),{formatMessage:j}=(0,L.useIntl)(),{params:{id:A}}=(0,i.useRouteMatch)("/settings/roles/:id"),[q,X]=(0,e.useState)(!1),te=(0,e.useRef)(),{lockApp:w,unlockApp:oe}=(0,P.useOverlayBlocker)(),{trackUsage:Ee}=(0,P.useTracking)(),{isLoading:g,data:xe}=(0,G.U_)(A),{role:ne,permissions:Ae,isLoading:fe,onSubmitSucceeded:ye}=(0,G.Dq)(A),he=async O=>{try{w(),X(!0);const{permissionsToSend:M,didUpdateConditions:le}=te.current.getPermissions();await(0,P.request)(`/admin/roles/${A}`,{method:"PUT",body:O}),ne.code!=="strapi-super-admin"&&(await(0,P.request)(`/admin/roles/${A}/permissions`,{method:"PUT",body:{permissions:M}}),le&&Ee("didUpdateConditions")),te.current.setFormAfterSubmit(),ye({name:O.name,description:O.description}),Z({type:"success",message:{id:"notification.success.saved"}})}catch(M){console.error(M.response);const le=J()(M,"response.payload.message","An error occured"),se=J()(M,"response.payload.data.permissions[0]",le);Z({type:"warning",message:se})}finally{X(!1),oe()}},K=ne.code==="strapi-super-admin";return e.createElement(l.Main,null,e.createElement(P.SettingsPageTitle,{name:"Roles"}),e.createElement(D.Formik,{enableReinitialize:!0,initialValues:{name:ne.name,description:ne.description},onSubmit:he,validationSchema:ee,validateOnChange:!1},({handleSubmit:O,values:M,errors:le,handleChange:se,handleBlur:Ve})=>e.createElement("form",{onSubmit:O},e.createElement(l.HeaderLayout,{primaryAction:e.createElement(l.Flex,{gap:2},e.createElement(l.Button,{disabled:ne.code==="strapi-super-admin",onClick:O,loading:q,size:"L"},j({id:"global.save",defaultMessage:"Save"}))),title:j({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:j({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(P.Link,{startIcon:e.createElement(V.ArrowLeft,null),to:"/settings/roles"},j({id:"global.back",defaultMessage:"Back"}))}),e.createElement(l.ContentLayout,null,e.createElement(l.Flex,{direction:"column",alignItems:"stretch",gap:6},e.createElement(ge,{isLoading:fe,disabled:K,errors:le,values:M,onChange:se,onBlur:Ve,role:ne}),!g&&!fe?e.createElement(l.Box,{shadow:"filterShadow",hasRadius:!0},e.createElement(E.Z,{isFormDisabled:K,permissions:Ae,ref:te,layout:xe})):e.createElement(l.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(P.LoadingIndicatorPage,null)))))))},B=()=>{const Z=(0,e.useMemo)(()=>({read:C.Z.settings.roles.read,update:C.Z.settings.roles.update}),[]),{isLoading:j,allowedActions:{canRead:A,canUpdate:q}}=(0,P.useRBAC)(Z);return j?e.createElement(P.LoadingIndicatorPage,null):!A&&!q?e.createElement(i.Redirect,{to:"/"}):e.createElement(ae,null)}},44174:z=>{function U(u,e,P,i){for(var C=-1,l=u==null?0:u.length;++C<l;){var D=u[C];e(i,D,P(D),u)}return i}z.exports=U},81119:(z,U,u)=>{var e=u(89881);function P(i,C,l,D){return e(i,function(V,W,J){C(D,V,l(V),J)}),D}z.exports=P},55189:(z,U,u)=>{var e=u(44174),P=u(81119),i=u(67206),C=u(1469);function l(D,V){return function(W,J){var L=C(W)?e:P,E=V?V():{};return L(W,D,i(J,2),E)}}z.exports=l},7739:(z,U,u)=>{var e=u(89465),P=u(55189),i=Object.prototype,C=i.hasOwnProperty,l=P(function(D,V,W){C.call(D,W)?D[W].push(V):e(D,W,[V])});z.exports=l}}]);
