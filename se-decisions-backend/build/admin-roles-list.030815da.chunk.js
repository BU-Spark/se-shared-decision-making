"use strict";(self.webpackChunkse_decisions_backend=self.webpackChunkse_decisions_backend||[]).push([[3455],{98906:(X,O,o)=>{o.r(O),o.d(O,{default:()=>G});var e=o(67294),i=o(95489),A=o(87751),C=o(41363),t=o(28702),B=o(96486),S=o(63852),M=o(97132),N=o(49656),F=o(48474);const W=()=>"todo empty role";var U=o(45697),f=o.n(U);const x=({id:n,name:d,description:l,usersCount:u,icons:g,rowIndex:r})=>{const{formatMessage:E}=(0,M.useIntl)(),h=E({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:u});return e.createElement(t.Tr,{"aria-rowindex":r,key:n,...(0,i.onRowClick)({fn:g[1].onClick})},e.createElement(t.Td,{maxWidth:(0,i.pxToRem)(130)},e.createElement(t.Typography,{ellipsis:!0,textColor:"neutral800"},d)),e.createElement(t.Td,{maxWidth:(0,i.pxToRem)(250)},e.createElement(t.Typography,{ellipsis:!0,textColor:"neutral800"},l)),e.createElement(t.Td,null,e.createElement(t.Typography,{textColor:"neutral800"},h)),e.createElement(t.Td,null,e.createElement(t.Flex,{justifyContent:"flex-end",...i.stopPropagation},g.map((a,p)=>a?e.createElement(t.Box,{key:a.label,paddingLeft:p===0?0:1},e.createElement(t.IconButton,{onClick:a.onClick,label:a.label,noBorder:!0,icon:a.icon})):null))))};x.propTypes={id:f().number.isRequired,name:f().string.isRequired,description:f().string.isRequired,usersCount:f().number.isRequired,icons:f().array.isRequired,rowIndex:f().number.isRequired};const V=x;var j=o(18172);const H={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},Z=(n,d)=>(0,j.default)(n,l=>{switch(d.type){case"ON_REMOVE_ROLES":{l.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{l.shouldRefetchData=!0,l.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{l.shouldRefetchData=!1,l.roleToDelete=null,l.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{l.roleToDelete=d.id;break}default:return l}}),Q=()=>{(0,i.useFocusWhenNavigate)();const{isLoading:n,allowedActions:{canCreate:d,canDelete:l,canRead:u,canUpdate:g}}=(0,i.useRBAC)(A.Z.settings.roles),{getData:r,roles:E,isLoading:h}=(0,F.bF)(!1),[{query:a}]=(0,i.useQueryParams)(),p=a?._q||"",R=(0,S.ZP)(E,p,{keys:["name","description"]});return(0,e.useEffect)(()=>{!n&&u&&r()},[n,u,r]),{isLoadingForPermissions:n,canCreate:d,canDelete:l,canRead:u,canUpdate:g,isLoading:h,getData:r,sortedRoles:R,roles:E}},$=({getData:n,canCreate:d,canDelete:l,canUpdate:u})=>{const{formatMessage:g}=(0,M.useIntl)(),r=(0,i.useNotification)(),[E,h]=(0,e.useState)(!1),{push:a}=(0,N.useHistory)(),[{selectedRoles:p,showModalConfirmButtonLoading:R,roleToDelete:b},T]=(0,e.useReducer)(Z,H),{post:P}=(0,i.getFetchClient)(),k=async()=>{try{T({type:"ON_REMOVE_ROLES"}),await P("/admin/roles/batch-delete",{ids:[b]}),await n(),T({type:"RESET_DATA_TO_DELETE"})}catch(s){const c=(0,B.get)(s,["response","payload","data","ids"],null);if(c&&Array.isArray(c)){const K=c.join(`
`);r({type:"warning",message:K})}else r({type:"warning",message:{id:"notification.error"}})}m()},y=(0,e.useCallback)(s=>{a(`/settings/roles/duplicate/${s}`)},[a]),v=()=>a("/settings/roles/new"),D=(0,e.useCallback)(s=>{T({type:"SET_ROLE_TO_DELETE",id:s}),m()},[]),m=()=>h(s=>!s),L=(0,e.useCallback)(s=>{a(`/settings/roles/${s}`)},[a]),w=(0,e.useCallback)((s,c)=>{s.preventDefault(),s.stopPropagation(),c.usersCount?r({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):D(c.id)},[r,D]),I=(0,e.useCallback)((s,c)=>{s.preventDefault(),s.stopPropagation(),y(c.id)},[y]),J=(0,e.useCallback)(s=>[...d?[{onClick:c=>I(c,s),label:g({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:e.createElement(C.Duplicate,null)}]:[],...u?[{onClick:()=>L(s.id),label:g({id:"app.utils.edit",defaultMessage:"Edit"}),icon:e.createElement(C.Pencil,null)}]:[],...l?[{onClick:c=>w(c,s),label:g({id:"global.delete",defaultMessage:"Delete"}),icon:e.createElement(C.Trash,null)}]:[]],[g,w,I,L,d,u,l]);return{handleNewRoleClick:v,getIcons:J,selectedRoles:p,isWarningDeleteAllOpened:E,showModalConfirmButtonLoading:R,handleToggleModal:m,handleDeleteData:k}},z=()=>{const{formatMessage:n}=(0,M.useIntl)(),{isLoadingForPermissions:d,canCreate:l,canRead:u,canDelete:g,canUpdate:r,isLoading:E,getData:h,sortedRoles:a}=Q(),{handleNewRoleClick:p,getIcons:R,isWarningDeleteAllOpened:b,showModalConfirmButtonLoading:T,handleToggleModal:P,handleDeleteData:k}=$({getData:h,canCreate:l,canDelete:g,canUpdate:r}),y=a.length+1,v=6;if(d)return e.createElement(t.Main,null,e.createElement(i.LoadingIndicatorPage,null));const D=n({id:"global.roles",defaultMessage:"roles"});return e.createElement(t.Main,null,e.createElement(i.SettingsPageTitle,{name:"Roles"}),e.createElement(t.HeaderLayout,{primaryAction:l?e.createElement(t.Button,{onClick:p,startIcon:e.createElement(C.Plus,null),size:"S"},n({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null,title:D,subtitle:n({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),u&&e.createElement(t.ActionLayout,{startActions:e.createElement(i.SearchURLQuery,{label:n({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:D})})}),u&&e.createElement(t.ContentLayout,null,e.createElement(t.Table,{colCount:v,rowCount:y,footer:l?e.createElement(t.TFooter,{onClick:p,icon:e.createElement(C.Plus,null)},n({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null},e.createElement(t.Thead,null,e.createElement(t.Tr,{"aria-rowindex":1},e.createElement(t.Th,null,e.createElement(t.Typography,{variant:"sigma",textColor:"neutral600"},n({id:"global.name",defaultMessage:"Name"}))),e.createElement(t.Th,null,e.createElement(t.Typography,{variant:"sigma",textColor:"neutral600"},n({id:"global.description",defaultMessage:"Description"}))),e.createElement(t.Th,null,e.createElement(t.Typography,{variant:"sigma",textColor:"neutral600"},n({id:"global.users",defaultMessage:"Users"}))),e.createElement(t.Th,null,e.createElement(t.VisuallyHidden,null,n({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(t.Tbody,null,a?.map((m,L)=>e.createElement(V,{key:m.id,id:m.id,name:m.name,description:m.description,usersCount:m.usersCount,icons:R(m),rowIndex:L+2})))),!y&&!E&&e.createElement(W,null)),e.createElement(i.ConfirmDialog,{isOpen:b,onConfirm:k,isConfirmButtonLoading:T,onToggleDialog:P}))},G=()=>e.createElement(i.CheckPagePermissions,{permissions:A.Z.settings.roles.main},e.createElement(z,null))}}]);
