"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[7259],{30493:function(I,E,e){e.d(E,{Z:function(){return v}});var t=e(32735),p=e(67879),n=e(60216),s=e.n(n),T=e(43383),a=e(66456),i=e(29439),u=e(82055),c=e(87933),M=e(41415),o=e(44647),m=e(67927);const f=({onRegenerate:R,idToRegenerate:r,backUrl:L,onError:x})=>{const{formatMessage:U}=(0,p.Z)(),[K,S]=(0,t.useState)(!1),{regenerateData:W,isLoadingConfirmation:k}=(0,m.rW)(L,r,R,x),B=async()=>{W(),S(!1)};return t.createElement(t.Fragment,null,t.createElement(M.z,{startIcon:t.createElement(o.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>S(!0),name:"regenerate"},U({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(T.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(o.Z,null),isConfirmButtonLoading:k,isOpen:K,onToggleDialog:()=>S(!1),onConfirm:B,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};f.defaultProps={onRegenerate(){},onError:void 0},f.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};var d=f;const l=({title:R,token:r,setToken:L,canEditInputs:x,canRegenerate:U,isSubmitting:K,backUrl:S,regenerateUrl:W,onErrorRegenerate:k})=>{const{formatMessage:B}=(0,p.Z)(),V=H=>{L({...r,accessKey:H})};return t.createElement(u.T,{title:r?.name||B(R),primaryAction:x?t.createElement(c.k,{gap:2},U&&r?.id&&t.createElement(d,{backUrl:W,onRegenerate:V,idToRegenerate:r?.id,onError:k}),t.createElement(M.z,{disabled:K,loading:K,startIcon:t.createElement(a.Z,null),type:"submit",size:"S"},B({id:"global.save",defaultMessage:"Save"}))):U&&r?.id&&t.createElement(d,{onRegenerate:V,idToRegenerate:r?.id,backUrl:W}),navigationAction:t.createElement(T.rU,{startIcon:t.createElement(i.Z,null),to:S},B({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};l.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},l.defaultProps={token:void 0,onErrorRegenerate:void 0};var v=l},4321:function(I,E,e){var t=e(32735),p=e(60216),n=e.n(p),s=e(67879),T=e(80084),a=e(84967),i=e(49372),u=e(37944);const c=({token:M,errors:o,values:m,onChange:f,isCreating:d})=>{const{formatMessage:l}=(0,s.Z)();return t.createElement(t.Fragment,null,t.createElement(T.P,{name:"lifespan",label:l({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:m.lifespan!==null?m.lifespan:"0",error:o.lifespan?l(o.lifespan?.id?o.lifespan:{id:o.lifespan,defaultMessage:o.lifespan}):null,onChange:v=>{f({target:{name:"lifespan",value:v}})},required:!0,disabled:!d,placeholder:"Select"},t.createElement(a.W,{value:"604800000"},l({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(a.W,{value:"2592000000"},l({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(a.W,{value:"7776000000"},l({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(a.W,{value:"0"},l({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(i.Z,{variant:"pi",textColor:"neutral600"},!d&&`${l({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,u.IX)(M?.createdAt,parseInt(m.lifespan,10))}`))};c.propTypes={errors:n().shape({lifespan:n().string}),onChange:n().func.isRequired,values:n().shape({lifespan:n().oneOfType([n().number,n().string])}).isRequired,isCreating:n().bool.isRequired,token:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string})},c.defaultProps={errors:{},token:{}},E.Z=c},93682:function(I,E,e){var t=e(32735),p=e(67879),n=e(43383),s=e(50563),T=e(47765),a=e(11631),i=e(60216),u=e.n(i),c=e(59087),M=e.n(c);const o=({token:m,tokenType:f})=>{const{formatMessage:d}=(0,p.Z)(),l=(0,n.lm)(),{trackUsage:v}=(0,n.rS)(),R=(0,t.useRef)(v);return t.createElement(n.Y_,{endAction:m&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(c.CopyToClipboard,{onCopy:()=>{R.current("didCopyTokenKey",{tokenType:f}),l({type:"success",message:{id:"Settings.tokens.notification.copied"}})},text:m},t.createElement(s.h,{label:d({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),noBorder:!0,icon:t.createElement(T.Z,null),style:{padding:0,height:"1rem"}}))),title:m||d({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:d(m?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(a.Z,null),iconBackground:"neutral100"})};o.defaultProps={token:null},o.propTypes={token:u().string,tokenType:u().string.isRequired},E.Z=o},42789:function(I,E,e){var t=e(32735),p=e(60216),n=e.n(p),s=e(67879),T=e(10508);const a=({errors:i,values:u,onChange:c,canEditInputs:M})=>{const{formatMessage:o}=(0,s.Z)();return t.createElement(T.g,{label:o({id:"Settings.tokens.form.description",defaultMessage:"Description"}),name:"description",error:i.description?o(i.description?.id?i.description:{id:i.description,defaultMessage:i.description}):null,onChange:c,disabled:!M},u.description)};a.propTypes={errors:n().shape({description:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({description:n().string}).isRequired},a.defaultProps={errors:{}},E.Z=a},8377:function(I,E,e){var t=e(32735),p=e(60216),n=e.n(p),s=e(67879),T=e(10369);const a=({errors:i,values:u,onChange:c,canEditInputs:M})=>{const{formatMessage:o}=(0,s.Z)();return t.createElement(T.o,{name:"name",error:i.name?o(i.name?.id?i.name:{id:i.name,defaultMessage:i.name}):null,label:o({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:c,value:u.name,disabled:!M,required:!0})};a.propTypes={errors:n().shape({name:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string}).isRequired},a.defaultProps={errors:{}},E.Z=a},49638:function(I,E,e){var t=e(32735),p=e(60216),n=e.n(p),s=e(67879),T=e(80084),a=e(84967);const i=({name:u,errors:c,values:M,onChange:o,canEditInputs:m,options:f,label:d})=>{const{formatMessage:l}=(0,s.Z)();return t.createElement(T.P,{name:u,label:l({id:d.id,defaultMessage:d.defaultMessage}),value:M&&M[u],error:c[u]?l(c[u]?.id?c[u]:{id:c[u],defaultMessage:c[u]}):null,onChange:o,placeholder:"Select",required:!0,disabled:!m},f&&f.map(({value:v,label:R})=>t.createElement(a.W,{key:v,value:v},l(R))))};i.propTypes={name:n().string,options:n().arrayOf(n().shape({label:n().shape({id:n().string,defaultMessage:n().string}),value:n().string})),errors:n().shape({type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({type:n().string}).isRequired,label:n().shape({id:n().string,defaultMessage:n().string}).isRequired},i.defaultProps={name:"type",errors:{},options:[]},E.Z=i},68774:function(I,E,e){e.d(E,{Z:function(){return t},f:function(){return p}});const t="api-token",p="transfer-token"},37944:function(I,E,e){e.d(E,{IX:function(){return T},fK:function(){return c},mk:function(){return o}});var t=e(14723),p=e(85544),n=e(76698),T=(m,f,d="en")=>{if(f&&typeof f=="number"){const l=f/24/60/60/1e3;return(0,t.Z)((0,p.Z)(new Date(m),l),"PPP",{locale:n[d]})}return"Unlimited"},a=e(24346),i=e(43383),c=a.Ry().shape({name:a.Z_(i.I0.string).max(100).required(i.I0.required),type:a.Z_(i.I0.string).oneOf(["read-only","full-access","custom"]).required(i.I0.required),description:a.Z_().nullable(),lifespan:a.Rx().integer().min(0).nullable().defined(i.I0.required)}),o=m=>{const f={allActionsIds:[],permissions:[]};return f.permissions=Object.keys(m).map(d=>({apiId:d,label:d.split("::")[1],controllers:Object.keys(m[d].controllers).map(l=>({controller:l,actions:m[d].controllers[l].map(v=>{const R=`${d}.${l}.${v}`;return d.includes("api::")&&f.allActionsIds.push(R),{action:v,actionId:R}}).flat()})).flat()})),f}},37259:function(I,E,e){e.d(E,{Z:function(){return ne}});var t=e(32735),p=e(67879),n=e(92802),s=e(53038),T=e(20108),a=e(43383),i=e(27649),u=e(17e3),c=e(87933),M=e(8997),o=e(24346),f=o.Ry().shape({name:o.Z_(a.I0.string).max(100).required(a.I0.required),description:o.Z_().nullable(),lifespan:o.Rx().integer().min(0).nullable().defined(a.I0.required),permissions:o.Z_(a.I0.string).required(a.I0.required)}),d=e(82055),l=e(41415),v=e(66456),R=e(60216),r=e.n(R);const L=({transferTokenName:D})=>{const{formatMessage:h}=(0,p.Z)();return(0,a.go)(),t.createElement(i.o,{"aria-busy":"true"},t.createElement(a.SL,{name:"Transfer Tokens"}),t.createElement(d.T,{primaryAction:t.createElement(l.z,{disabled:!0,startIcon:t.createElement(v.Z,null),type:"button",size:"L"},h({id:"global.save",defaultMessage:"Save"})),title:D||h({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),t.createElement(u.D,null,t.createElement(a.dO,null)))};L.defaultProps={transferTokenName:null},L.propTypes={transferTokenName:r().string};var x=L,U=e(83983),K=e(72850),S=e(49372),W=e(15335),k=e(5803),B=e(4321),V=e(8377),H=e(42789),J=e(49638);const j=({errors:D,onChange:h,canEditInputs:Z,isCreating:O,values:A,transferToken:y})=>{const{formatMessage:N}=(0,p.Z)(),G=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return t.createElement(K.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(c.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(S.Z,{variant:"delta",as:"h2"},N({id:"global.details",defaultMessage:"Details"})),t.createElement(W.r,{gap:5},t.createElement(k.P,{key:"name",col:6,xs:12},t.createElement(V.Z,{errors:D,values:A,canEditInputs:Z,onChange:h})),t.createElement(k.P,{key:"description",col:6,xs:12},t.createElement(H.Z,{errors:D,values:A,canEditInputs:Z,onChange:h})),t.createElement(k.P,{key:"lifespan",col:6,xs:12},t.createElement(B.Z,{isCreating:O,errors:D,values:A,onChange:h,token:y})),t.createElement(k.P,{key:"permissions",col:6,xs:12},t.createElement(J.Z,{name:"permissions",values:A,errors:D,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:F=>{h({target:{name:"permissions",value:F}})},options:G,canEditInputs:Z})))))};j.propTypes={errors:r().shape({name:r().string,description:r().string,lifespan:r().string,type:r().string}),onChange:r().func.isRequired,canEditInputs:r().bool.isRequired,values:r().shape({name:r().string,description:r().string,lifespan:r().oneOfType([r().number,r().string]),type:r().string}).isRequired,isCreating:r().bool.isRequired,transferToken:r().shape({id:r().oneOfType([r().number,r().string]),type:r().string,lifespan:r().string,name:r().string,accessKey:r().string,permissions:r().array,description:r().string,createdAt:r().string})},j.defaultProps={errors:{},transferToken:{}};var q=j,w=e(93682),ee=e(30493),$=e(68774);const te="Name already taken";var ne=()=>{(0,a.go)();const{formatMessage:D}=(0,p.Z)(),{lockApp:h,unlockApp:Z}=(0,a.o1)(),O=(0,a.lm)(),A=(0,s.k6)(),[y,N]=(0,t.useState)(A.location.state?.transferToken.accessKey?{...A.location.state.transferToken}:null),{trackUsage:G}=(0,a.rS)(),F=(0,t.useRef)(G),{setCurrentStep:se}=(0,a.c1)(),{allowedActions:{canCreate:ae,canUpdate:re,canRegenerate:ie}}=(0,a.ss)(U.Z.settings["transfer-tokens"]),{params:{id:z}}=(0,s.$B)("/settings/transfer-tokens/:id"),{get:oe,post:le,put:de}=(0,a.kY)(),P=z==="create",{formatAPIError:Q}=(0,a.So)();(0,t.useEffect)(()=>{F.current(P?"didAddTokenFromList":"didEditTokenFromList",{tokenType:$.f})},[P]);const{status:ce}=(0,T.useQuery)(["transfer-token",z],async()=>{const{data:{data:g}}=await oe(`/admin/transfer/tokens/${z}`);return N({...g}),g},{enabled:!P&&!y,onError(g){g.response.data.error.details?.code==="INVALID_TOKEN_SALT"?O({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):O({type:"warning",message:Q(g)})}}),ue=async(g,_)=>{F.current(P?"willCreateToken":"willEditToken",{tokenType:$.f}),h();const b=g.lifespan&&parseInt(g.lifespan,10)&&g.lifespan!=="0"?parseInt(g.lifespan,10):null,Y=g.permissions.split("-");try{const{data:{data:C}}=P?await le("/admin/transfer/tokens",{...g,lifespan:b,permissions:Y}):await de(`/admin/transfer/tokens/${z}`,{name:g.name,description:g.description,permissions:Y});Z(),P&&(A.replace(`/settings/transfer-tokens/${C.id}`,{transferToken:C}),se("transferTokens.success")),N({...C}),O({type:"success",message:D(P?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),F.current(P?"didCreateToken":"didEditToken",{type:y?.permissions,tokenType:$.f})}catch(C){const pe=(0,M.Iz)(C.response.data);_.setErrors(pe),C?.response?.data?.error?.message===te?O({type:"warning",message:C.response.data.message||"notification.error.tokennamenotunique"}):C?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?O({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):O({type:"warning",message:C?.response?.data?.message||"notification.error"}),Z()}},X=re&&!P||ae&&P;if(!P&&!y&&ce!=="success")return t.createElement(x,{transferTokenName:y?.name});const ge=g=>{g?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?O({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):O({type:"warning",message:Q(g)})};return t.createElement(i.o,null,t.createElement(a.SL,{name:"Transfer Tokens"}),t.createElement(n.J9,{validationSchema:f,validateOnChange:!1,initialValues:{name:y?.name||"",description:y?.description||"",lifespan:y?.lifespan?y.lifespan.toString():y?.lifespan,permissions:y?.permissions.join("-")},enableReinitialize:!0,onSubmit:(g,_)=>ue(g,_)},({errors:g,handleChange:_,isSubmitting:b,values:Y})=>t.createElement(a.l0,null,t.createElement(ee.Z,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"},token:y,setToken:N,canEditInputs:X,canRegenerate:ie,isSubmitting:b,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:ge}),t.createElement(u.D,null,t.createElement(c.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(y?.name)&&t.createElement(w.Z,{token:y?.accessKey,tokenType:$.f}),t.createElement(q,{errors:g,onChange:_,canEditInputs:X,isCreating:P,values:Y,transferToken:y}))))))}}}]);
