"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[9600],{81450:function(H,v,n){n.d(v,{Z:function(){return R}});var e=n(32735),s=n(5141),A=n(60216),t=n.n(A),a=n(39161),l=n(13478),C=n(57269),D=n(5636);const k=({tokenName:r,onClickDelete:c,tokenType:E})=>{const{formatMessage:d}=(0,D.useIntl)(),{trackUsage:f}=(0,l.useTracking)(),[u,p]=(0,e.useState)(!1),h=()=>{p(!1),f("willDeleteToken",{tokenType:E}),c()};return e.createElement(a.Box,{paddingLeft:1,onClick:T=>T.stopPropagation()},e.createElement(a.IconButton,{onClick:()=>{p(!0)},label:d({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${r}`}),name:"delete",noBorder:!0,icon:e.createElement(C.Trash,null)}),e.createElement(l.ConfirmDialog,{onToggleDialog:()=>p(!1),onConfirm:h,isOpen:u}))};k.propTypes={tokenName:t().string.isRequired,onClickDelete:t().func.isRequired,tokenType:t().string.isRequired};var L=k,W=n(83292);const w={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},U=(0,W.default)(l.Link)`
  svg {
    path {
      fill: ${({theme:r})=>r.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:r})=>r.colors.neutral800};
      }
    }
  }
`,g=({tokenName:r,tokenId:c,buttonType:E,children:d})=>{const{formatMessage:f}=(0,D.useIntl)(),{location:{pathname:u}}=(0,s.useHistory)();return e.createElement(U,{to:`${u}/${c}`,title:f(w[E],{target:r})},d)};g.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired,buttonType:t().string,children:t().node.isRequired},g.defaultProps={buttonType:"edit"};var I=g;const S=({tokenName:r,tokenId:c})=>e.createElement(I,{tokenName:r,tokenId:c},e.createElement(C.Pencil,null));S.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired};var Z=S;const M=({tokenName:r,tokenId:c})=>e.createElement(I,{tokenName:r,tokenId:c,buttonType:"read"},e.createElement(C.Eye,null));M.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired};var V=M;const m=({permissions:r,headers:c,contentType:E,isLoading:d,tokens:f,onConfirmDelete:u,tokenType:p})=>{const{canDelete:h,canUpdate:T,canRead:N}=r,P=h||T||N,[{query:y}]=(0,l.useQueryParams)(),[,b]=y?y.sort.split(":"):"ASC",{push:x,location:{pathname:B}}=(0,s.useHistory)(),{trackUsage:F}=(0,l.useTracking)(),O=f.sort((o,$)=>{const i=o.name.localeCompare($.name);return b==="DESC"?-i:i});return e.createElement(l.DynamicTable,{headers:c,contentType:E,rows:f,withBulkActions:P,isLoading:d,onConfirmDelete:u},e.createElement(a.Tbody,null,O.map(o=>e.createElement(a.Tr,{key:o.id,...(0,l.onRowClick)({fn(){F("willEditTokenFromList",{tokenType:p}),x(`${B}/${o.id}`)},condition:T})},e.createElement(a.Td,{maxWidth:(0,l.pxToRem)(250)},e.createElement(a.Typography,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},o.name)),e.createElement(a.Td,{maxWidth:(0,l.pxToRem)(250)},e.createElement(a.Typography,{textColor:"neutral800",ellipsis:!0},o.description)),e.createElement(a.Td,null,e.createElement(a.Typography,{textColor:"neutral800"},e.createElement(l.RelativeTime,{timestamp:new Date(o.createdAt)}))),e.createElement(a.Td,null,o.lastUsedAt&&e.createElement(a.Typography,{textColor:"neutral800"},e.createElement(l.RelativeTime,{timestamp:new Date(o.lastUsedAt)}))),P&&e.createElement(a.Td,null,e.createElement(a.Flex,{justifyContent:"end"},T&&e.createElement(Z,{tokenName:o.name,tokenId:o.id}),!T&&N&&e.createElement(V,{tokenName:o.name,tokenId:o.id}),h&&e.createElement(L,{tokenName:o.name,onClickDelete:()=>u(o.id),tokenType:p})))))))};m.propTypes={tokens:t().array,permissions:t().shape({canRead:t().bool,canDelete:t().bool,canUpdate:t().bool}).isRequired,headers:t().arrayOf(t().shape({cellFormatter:t().func,key:t().string.isRequired,metadatas:t().shape({label:t().string.isRequired,sortable:t().bool}).isRequired,name:t().string.isRequired})),contentType:t().string.isRequired,isLoading:t().bool,onConfirmDelete:t().func,tokenType:t().string.isRequired},m.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};var R=m},68774:function(H,v,n){n.d(v,{Z:function(){return e},f:function(){return s}});const e="api-token",s="transfer-token"},38286:function(H,v,n){n.r(v),n.d(v,{default:function(){return M}});var e=n(32735),s=n(13478),A=n(72041),t=n(5636),a=n(84968),l=n(5141),C=n(33348),D=n.n(C),k=n(39161),L=n(57269),w=[{name:"name",key:"name",metadatas:{label:{id:"Settings.tokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.tokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],U=n(81450),g=n(68774),S=()=>{(0,s.useFocusWhenNavigate)();const V=(0,a.useQueryClient)(),{formatMessage:m}=(0,t.useIntl)(),R=(0,s.useNotification)(),{allowedActions:{canCreate:r,canDelete:c,canUpdate:E,canRead:d}}=(0,s.useRBAC)(A.Z.settings["transfer-tokens"]),{push:f}=(0,l.useHistory)(),{trackUsage:u}=(0,s.useTracking)(),{startSection:p}=(0,s.useGuidedTour)(),h=(0,e.useRef)(p),{get:T,del:N}=(0,s.useFetchClient)();(0,e.useEffect)(()=>{h.current&&h.current("transferTokens")},[]),(0,e.useEffect)(()=>{f({search:D().stringify({sort:"name:ASC"},{encode:!1})})},[f]);const P=w.map(i=>({...i,metadatas:{...i.metadatas,label:m(i.metadatas.label)}})),{data:y,status:b,isFetching:x}=(0,a.useQuery)(["transfer-tokens"],async()=>{u("willAccessTokenList",{tokenType:g.f});const{data:{data:i}}=await T("/admin/transfer/tokens");return u("didAccessTokenList",{number:i.length,tokenType:g.f}),i},{enabled:d,onError(){R({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),B=d&&(b!=="success"&&b!=="error"||b==="success"&&x),F=(0,a.useMutation)(async i=>{await N(`/admin/transfer/tokens/${i}`)},{async onSuccess(){await V.invalidateQueries(["transfer-tokens"])},onError(i){i?.response?.data?.data?R({type:"warning",message:i.response.data.data}):R({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),O=d&&y,o=d&&!y&&!r,$=d&&!y&&r;return e.createElement(k.Main,{"aria-busy":B},e.createElement(s.SettingsPageTitle,{name:"Transfer Tokens"}),e.createElement(k.HeaderLayout,{title:m({id:"Settings.transferTokens.title",defaultMessage:"Transfer Tokens"}),subtitle:m({id:"Settings.transferTokens.description",defaultMessage:'"List of generated transfer tokens"'}),primaryAction:r?e.createElement(s.LinkButton,{"data-testid":"create-transfer-token-button",startIcon:e.createElement(L.Plus,null),size:"S",onClick:()=>u("willAddTokenFromList",{tokenType:g.f}),to:"/settings/transfer-tokens/create"},m({id:"Settings.transferTokens.create",defaultMessage:"Create new Transfer Token"})):void 0}),e.createElement(k.ContentLayout,null,!d&&e.createElement(s.NoPermissions,null),O&&e.createElement(U.Z,{permissions:{canRead:d,canDelete:c,canUpdate:E},headers:P,contentType:"trasfer-tokens",rows:y,isLoading:B,onConfirmDelete:i=>F.mutateAsync(i),tokens:y,tokenType:g.f}),$&&e.createElement(s.NoContent,{content:{id:"Settings.transferTokens.addFirstToken",defaultMessage:"Add your first Transfer Token"},action:e.createElement(k.Button,{variant:"secondary",startIcon:e.createElement(L.Plus,null)},m({id:"Settings.transferTokens.addNewToken",defaultMessage:"Add new Transfer Token"}))}),o&&e.createElement(s.NoContent,{content:{id:"Settings.transferTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},M=()=>e.createElement(s.CheckPagePermissions,{permissions:A.Z.settings["transfer-tokens"].main},e.createElement(S,null))}}]);
