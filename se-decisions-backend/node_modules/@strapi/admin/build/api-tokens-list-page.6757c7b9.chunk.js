"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[8056],{81450:function(Y,v,t){t.d(v,{Z:function(){return I}});var e=t(32735),s=t(53038),L=t(60216),n=t.n(L),A=t(35658),U=t(94547),y=t(19786),k=t(49372),V=t(87933),i=t(43383),x=t(4038),O=t(72850),M=t(50563),F=t(67879);const Z=({tokenName:a,onClickDelete:c,tokenType:m})=>{const{formatMessage:E}=(0,F.Z)(),{trackUsage:p}=(0,i.rS)(),[g,l]=(0,e.useState)(!1),f=()=>{l(!1),p("willDeleteToken",{tokenType:m}),c()};return e.createElement(O.x,{paddingLeft:1,onClick:T=>T.stopPropagation()},e.createElement(M.h,{onClick:()=>{l(!0)},label:E({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${a}`}),name:"delete",noBorder:!0,icon:e.createElement(x.Z,null)}),e.createElement(i.QH,{onToggleDialog:()=>l(!1),onConfirm:f,isOpen:g}))};Z.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired,tokenType:n().string.isRequired};var $=Z,h=t(68625),w=t(8471);const Q={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},K=(0,w.ZP)(i.rU)`
  svg {
    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:a})=>a.colors.neutral800};
      }
    }
  }
`,C=({tokenName:a,tokenId:c,buttonType:m,children:E})=>{const{formatMessage:p}=(0,F.Z)(),{location:{pathname:g}}=(0,s.k6)();return e.createElement(K,{to:`${g}/${c}`,title:p(Q[m],{target:a})},E)};C.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},C.defaultProps={buttonType:"edit"};var b=C;const u=({tokenName:a,tokenId:c})=>e.createElement(b,{tokenName:a,tokenId:c},e.createElement(h.Z,null));u.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};var S=u,D=t(54894);const P=({tokenName:a,tokenId:c})=>e.createElement(b,{tokenName:a,tokenId:c,buttonType:"read"},e.createElement(D.Z,null));P.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};var H=P;const d=({permissions:a,headers:c,contentType:m,isLoading:E,tokens:p,onConfirmDelete:g,tokenType:l})=>{const{canDelete:f,canUpdate:T,canRead:R}=a,N=f||T||R,[{query:B}]=(0,i.Kx)(),[,j]=B?B.sort.split(":"):"ASC",{push:W,location:{pathname:o}}=(0,s.k6)(),{trackUsage:J}=(0,i.rS)(),G=p.sort((r,X)=>{const z=r.name.localeCompare(X.name);return j==="DESC"?-z:z});return e.createElement(i.tM,{headers:c,contentType:m,rows:p,withBulkActions:N,isLoading:E,onConfirmDelete:g},e.createElement(A.p,null,G.map(r=>e.createElement(U.Tr,{key:r.id,...(0,i.X7)({fn(){J("willEditTokenFromList",{tokenType:l}),W(`${o}/${r.id}`)},condition:T})},e.createElement(y.Td,{maxWidth:(0,i.Q1)(250)},e.createElement(k.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},r.name)),e.createElement(y.Td,{maxWidth:(0,i.Q1)(250)},e.createElement(k.Z,{textColor:"neutral800",ellipsis:!0},r.description)),e.createElement(y.Td,null,e.createElement(k.Z,{textColor:"neutral800"},e.createElement(i.ij,{timestamp:new Date(r.createdAt)}))),e.createElement(y.Td,null,r.lastUsedAt&&e.createElement(k.Z,{textColor:"neutral800"},e.createElement(i.ij,{timestamp:new Date(r.lastUsedAt)}))),N&&e.createElement(y.Td,null,e.createElement(V.k,{justifyContent:"end"},T&&e.createElement(S,{tokenName:r.name,tokenId:r.id}),!T&&R&&e.createElement(H,{tokenName:r.name,tokenId:r.id}),f&&e.createElement($,{tokenName:r.name,onClickDelete:()=>g(r.id),tokenType:l})))))))};d.propTypes={tokens:n().array,permissions:n().shape({canRead:n().bool,canDelete:n().bool,canUpdate:n().bool}).isRequired,headers:n().arrayOf(n().shape({cellFormatter:n().func,key:n().string.isRequired,metadatas:n().shape({label:n().string.isRequired,sortable:n().bool}).isRequired,name:n().string.isRequired})),contentType:n().string.isRequired,isLoading:n().bool,onConfirmDelete:n().func,tokenType:n().string.isRequired},d.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};var I=d},68774:function(Y,v,t){t.d(v,{Z:function(){return e},f:function(){return s}});const e="api-token",s="transfer-token"},37168:function(Y,v,t){t.r(v),t.d(v,{default:function(){return C}});var e=t(32735),s=t(43383),L=t(83983),n=t(67879),A=t(20108),U=t(53038),y=t(33348),k=t.n(y),V=t(27649),i=t(82055),x=t(17e3),O=t(41415),M=t(19406),Z=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],$=t(81450),h=t(68774),Q=()=>{(0,s.go)();const b=(0,A.useQueryClient)(),{formatMessage:u}=(0,n.Z)(),S=(0,s.lm)(),{allowedActions:{canCreate:D,canDelete:P,canUpdate:H,canRead:d}}=(0,s.ss)(L.Z.settings["api-tokens"]),{push:I}=(0,U.k6)(),{trackUsage:a}=(0,s.rS)(),{startSection:c}=(0,s.c1)(),m=(0,e.useRef)(c),{get:E,del:p}=(0,s.kY)();(0,e.useEffect)(()=>{m.current&&m.current("apiTokens")},[]),(0,e.useEffect)(()=>{I({search:k().stringify({sort:"name:ASC"},{encode:!1})})},[I]);const g=Z.map(o=>({...o,metadatas:{...o.metadatas,label:u(o.metadatas.label)}})),{data:l,status:f,isFetching:T}=(0,A.useQuery)(["api-tokens"],async()=>{a("willAccessTokenList",{tokenType:h.Z});const{data:{data:o}}=await E("/admin/api-tokens");return a("didAccessTokenList",{number:o.length,tokenType:h.Z}),o},{enabled:d,onError(){S({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),R=d&&(f!=="success"&&f!=="error"||f==="success"&&T),N=(0,A.useMutation)(async o=>{await p(`/admin/api-tokens/${o}`)},{async onSuccess(){await b.invalidateQueries(["api-tokens"]),a("didDeleteToken")},onError(o){o?.response?.data?.data?S({type:"warning",message:o.response.data.data}):S({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),B=d&&l,j=d&&!l&&!D,W=d&&!l&&D;return e.createElement(V.o,{"aria-busy":R},e.createElement(s.SL,{name:"API Tokens"}),e.createElement(i.T,{title:u({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:u({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:D?e.createElement(s.Qj,{"data-testid":"create-api-token-button",startIcon:e.createElement(M.Z,null),size:"S",onClick:()=>a("willAddTokenFromList",{tokenType:h.Z}),to:"/settings/api-tokens/create"},u({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})):void 0}),e.createElement(x.D,null,!d&&e.createElement(s.ZF,null),B&&e.createElement($.Z,{permissions:{canRead:d,canDelete:P,canUpdate:H},headers:g,contentType:"api-tokens",rows:l,isLoading:R,onConfirmDelete:o=>N.mutateAsync(o),tokens:l,tokenType:h.Z}),W&&e.createElement(s.dJ,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:e.createElement(O.z,{variant:"secondary",startIcon:e.createElement(M.Z,null)},u({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),j&&e.createElement(s.dJ,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},C=()=>e.createElement(s.O4,{permissions:L.Z.settings["api-tokens"].main},e.createElement(Q,null))}}]);
