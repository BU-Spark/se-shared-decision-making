(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[2544],{92034:function(z,U,u){"use strict";u.r(U),u.d(U,{CreatePage:function(){return ae},default:function(){return ce}});var e=u(32735),P=u(64213),r=u(13478),C=u(39161),l=u(57269),D=u(83281),V=u(33795),W=u.n(V),J=u(86834),L=u.n(J),E=u(5636),pe=u(5141),Q=u(83292),_=u(7247),ge=u(8888),G=u(72041),ie=u(5173),ee=ie.Ry().shape({name:ie.Z_().required(r.translatedErrors.required),description:ie.Z_().required(r.translatedErrors.required)});const Se=Q.default.div`
  border: 1px solid ${({theme:B})=>B.colors.primary200};
  background: ${({theme:B})=>B.colors.primary100};
  padding: ${({theme:B})=>`${B.spaces[2]} ${B.spaces[4]}`};
  color: ${({theme:B})=>B.colors.primary600};
  border-radius: ${({theme:B})=>B.borderRadius};
  font-size: ${12/16}rem;
  font-weight: bold;
`,ae=()=>{const B=(0,r.useNotification)(),{lockApp:Z,unlockApp:j}=(0,r.useOverlayBlocker)(),{formatMessage:A}=(0,E.useIntl)(),[q,X]=(0,e.useState)(!1),{replace:te}=(0,pe.useHistory)(),w=(0,e.useRef)(),{trackUsage:oe}=(0,r.useTracking)(),Ee=(0,pe.useRouteMatch)("/settings/roles/duplicate/:id"),g=W()(Ee,"params.id",null),{isLoading:ve,data:ne}=(0,ge.U_)(),{permissions:Ae,isLoading:fe}=(0,ge.Dq)(g),ye=K=>{Z(),X(!0),oe(g?"willDuplicateRole":"willCreateNewRole"),Promise.resolve((0,r.request)("/admin/roles",{method:"POST",body:K})).then(async O=>{const{permissionsToSend:M}=w.current.getPermissions();return oe(g?"didDuplicateRole":"didCreateNewRole"),O.data.id&&!L()(M)&&await(0,r.request)(`/admin/roles/${O.data.id}/permissions`,{method:"PUT",body:{permissions:M}}),O}).then(O=>{X(!1),B({type:"success",message:{id:"Settings.roles.created",defaultMessage:"created"}}),te(`/settings/roles/${O.data.id}`)}).catch(O=>{console.error(O),X(!1),B({type:"warning",message:{id:"notification.error"}})}).finally(()=>{j()})},he=`${A({id:"Settings.roles.form.created",defaultMessage:"Created"})} ${(0,P.format)(new Date,"PPP")}`;return e.createElement(C.Main,null,e.createElement(r.SettingsPageTitle,{name:"Roles"}),e.createElement(D.Formik,{initialValues:{name:"",description:he},onSubmit:ye,validationSchema:ee,validateOnChange:!1},({handleSubmit:K,values:O,errors:M,handleReset:le,handleChange:se})=>e.createElement(r.Form,{noValidate:!0},e.createElement(e.Fragment,null,e.createElement(C.HeaderLayout,{primaryAction:e.createElement(C.Flex,{gap:2},e.createElement(C.Button,{variant:"secondary",onClick:()=>{le(),w.current.resetForm()},size:"L"},A({id:"app.components.Button.reset",defaultMessage:"Reset"})),e.createElement(C.Button,{onClick:K,loading:q,size:"L"},A({id:"global.save",defaultMessage:"Save"}))),title:A({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:A({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(r.Link,{startIcon:e.createElement(l.ArrowLeft,null),to:"/settings/roles"},A({id:"global.back",defaultMessage:"Back"}))}),e.createElement(C.ContentLayout,null,e.createElement(C.Flex,{direction:"column",alignItems:"stretch",gap:6},e.createElement(C.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(C.Flex,{direction:"column",alignItems:"stretch",gap:4},e.createElement(C.Flex,{justifyContent:"space-between"},e.createElement(C.Box,null,e.createElement(C.Box,null,e.createElement(C.Typography,{fontWeight:"bold"},A({id:"global.details",defaultMessage:"Details"}))),e.createElement(C.Box,null,e.createElement(C.Typography,{variant:"pi",textColor:"neutral600"},A({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(Se,null,A({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:0}))),e.createElement(C.Grid,{gap:4},e.createElement(C.GridItem,{col:6},e.createElement(C.TextInput,{name:"name",error:M.name&&A({id:M.name}),label:A({id:"global.name",defaultMessage:"Name"}),onChange:se,value:O.name})),e.createElement(C.GridItem,{col:6},e.createElement(C.Textarea,{label:A({id:"global.description",defaultMessage:"Description"}),name:"description",error:M.description&&A({id:M.description}),onChange:se},O.description))))),!ve&&!fe?e.createElement(C.Box,{shadow:"filterShadow",hasRadius:!0},e.createElement(_.Z,{isFormDisabled:!1,ref:w,permissions:Ae,layout:ne})):e.createElement(C.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(r.LoadingIndicatorPage,null))))))))};function ce(){return e.createElement(r.CheckPagePermissions,{permissions:G.Z.settings.roles.create},e.createElement(ae,null))}},7247:function(z,U,u){"use strict";u.d(U,{Z:function(){return Tn}});var e=u(32735),P=u(60216),r=u.n(P),C=u(13478),l=u(39161),D=u(23973),V=u.n(D),W=u(86834),J=u.n(W),L=u(5636),E=u(83292),pe=u(98978),Q=u.n(pe),_=u(57269),ge=u(33795),G=u.n(ge),ie=u(9086),ke=u.n(ie),ee=u(8888);const Se=E.default.div`
  position: relative;

  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: -3px;
      left: -10px;
      width: 6px;
      height: 6px;
      border-radius: ${20/16}rem;;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,ae=({onClick:t,className:n,hasConditions:o,variant:s})=>{const{formatMessage:i}=(0,L.useIntl)();return e.createElement(Se,{hasConditions:o,className:n},e.createElement(l.Button,{variant:s,startIcon:e.createElement(_.Cog,null),onClick:t},i({id:"global.settings",defaultMessage:"Settings"})))};ae.defaultProps={className:null,hasConditions:!1,variant:"tertiary"},ae.propTypes={onClick:r().func.isRequired,className:r().string,hasConditions:r().bool,variant:r().string};var ce=(0,E.default)(ae)``,B=u(97889),Z=u(81346),j=u.n(Z),A=u(23940),q=u.n(A);const X=t=>Object.values(t).map(n=>Object.entries(n).filter(([,o])=>o).map(([o])=>o)).flat(),te=t=>t.reduce((n,[o,s])=>(n.push({label:q()(o),children:s.map(i=>({label:i.displayName,value:i.id}))}),n),[]),w=(t,n)=>t.map(([,o])=>o).flat().reduce((o,s)=>({[s.id]:n.includes(s.id),...o}),{}),oe=({arrayOfOptionsGroupedByCategory:t,isFormDisabled:n,isGrey:o,label:s,name:i,onChange:a,value:c})=>{const{formatMessage:d}=(0,L.useIntl)(),p=m=>{a(i,w(t,m))};return e.createElement(l.Flex,{as:"li",background:o?"neutral100":"neutral0",paddingBottom:3,paddingTop:3},e.createElement(l.Flex,{paddingLeft:6,style:{width:180}},e.createElement(l.Typography,{variant:"sigma",textColor:"neutral600"},d({id:"Settings.permissions.conditions.can",defaultMessage:"Can"}),"\xA0"),e.createElement(l.Typography,{variant:"sigma",title:s,textColor:"primary600",ellipsis:!0},d({id:`Settings.roles.form.permissions.${s.toLowerCase()}`,defaultMessage:s})),e.createElement(l.Typography,{variant:"sigma",textColor:"neutral600"},"\xA0",d({id:"Settings.permissions.conditions.when",defaultMessage:"When"}))),e.createElement(l.Box,{style:{maxWidth:430,width:"100%"}},e.createElement(l.MultiSelectNested,{id:i,customizeContent:m=>`${m.length} currently selected`,onChange:p,value:X(c),options:te(t),disabled:n})))};oe.propTypes={arrayOfOptionsGroupedByCategory:r().array.isRequired,isFormDisabled:r().bool.isRequired,isGrey:r().bool.isRequired,label:r().string.isRequired,name:r().string.isRequired,value:r().object.isRequired,onChange:r().func.isRequired};var Ee=oe,g=u(92891);const ve=(t,n)=>t.reduce((o,s)=>(o[s.id]=(0,g.get)(n,s.id,!1),o),{}),ne=(t,n)=>t.reduce((o,s)=>{const[i,a]=s,c=ve(a,n);return o[i]=c,o},{});var fe=(t,n,o)=>t.reduce((s,i)=>{const a=(0,g.get)(n,[...i.pathToConditionsObject,"conditions"],{}),c=ne(o,a);return s[i.pathToConditionsObject.join("..")]=c,s},{});const ye=({actions:t,headerBreadCrumbs:n,isFormDisabled:o,onClosed:s,onToggle:i})=>{const{formatMessage:a}=(0,L.useIntl)(),{availableConditions:c,modifiedData:d,onChangeConditions:p}=(0,ee.$_)(),m=(0,e.useMemo)(()=>Object.entries(j()(c,"category")),[c]),f=t.filter(({isDisplayed:y,hasSomeActionsSelected:T,hasAllActionsSelected:R})=>y&&(T||R)),h=(0,e.useMemo)(()=>fe(f,d,m),[f,d,m]),[v,k]=(0,e.useState)(h),x=(y,T)=>{k((0,B.default)(R=>{R[y]||(R[y]={}),R[y].default||(R[y].default={}),R[y].default=T}))},b=()=>{const y=Object.entries(v).reduce((T,R)=>{const[S,N]=R,F=Object.values(N).reduce((I,$)=>({...I,...$}),{});return T[S]=F,T},{});p(y),i()};return e.createElement(l.ModalLayout,{labelledBy:"condition-modal-breadcrumbs",onClose:s},e.createElement(l.ModalHeader,null,e.createElement(l.Breadcrumbs,{id:"condition-modal-breadcrumbs",label:n.join(", ")},n.map(y=>e.createElement(l.Crumb,{key:y},q()(a({id:y,defaultMessage:y})))))),e.createElement(l.ModalBody,null,f.length===0&&e.createElement(l.Typography,null,a({id:"Settings.permissions.conditions.no-actions",defaultMessage:"You first need to select actions (create, read, update, ...) before defining conditions on them."})),e.createElement("ul",null,f.map(({actionId:y,label:T,pathToConditionsObject:R},S)=>{const N=R.join("..");return e.createElement(Ee,{key:y,arrayOfOptionsGroupedByCategory:m,label:T,isFormDisabled:o,isGrey:S%2===0,name:N,onChange:x,value:G()(v,N,{})})}))),e.createElement(l.ModalFooter,{startActions:e.createElement(l.Button,{variant:"tertiary",onClick:i},a({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(l.Button,{onClick:b},a({id:"Settings.permissions.conditions.apply",defaultMessage:"Apply"}))}))};ye.propTypes={actions:r().arrayOf(r().shape({actionId:r().string.isRequired,checkboxName:r().string,hasSomeActionsSelected:r().bool.isRequired,hasAllActionsSelected:r().bool,isDisplayed:r().bool.isRequired,label:r().string})).isRequired,headerBreadCrumbs:r().arrayOf(r().string).isRequired,isFormDisabled:r().bool.isRequired,onClosed:r().func.isRequired,onToggle:r().func.isRequired};var he=ye;const K=`${120/16}rem`,O=`${200/16}rem`,M=`${53/16}rem`;var se=E.default.div`
  width: ${K};
`,Ge=(0,E.default)(l.Flex)`
  padding-right: ${({theme:t})=>t.spaces[2]};
  overflow: hidden;
  flex: 1;
  ${({isCollapsable:t})=>t&&"cursor: pointer;"}
`;const Oe=({children:t,isCollapsable:n,isActive:o,isFormDisabled:s,label:i,onChange:a,onClick:c,checkboxName:d,someChecked:p,value:m})=>{const{formatMessage:f}=(0,L.useIntl)();return e.createElement(l.Flex,{alignItems:"center",paddingLeft:6,style:{width:O,flexShrink:0}},e.createElement(l.Box,{paddingRight:2},e.createElement(l.BaseCheckbox,{name:d,"aria-label":f({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:i}),disabled:s,onValueChange:h=>a({target:{name:d,value:h}}),indeterminate:p,value:m})),e.createElement(Ge,{title:i,alignItems:"center",isCollapsable:n,...n&&{onClick:c,"aria-expanded":o,onKeyDown:({key:h})=>(h==="Enter"||h===" ")&&c(),tabIndex:0,role:"button"}},e.createElement(l.Typography,{fontWeight:o?"bold":"",textColor:o?"primary600":"neutral800",ellipsis:!0},q()(i)),t))};Oe.defaultProps={children:null,checkboxName:"",onChange(){},value:!1,someChecked:!1,isCollapsable:!1},Oe.propTypes={checkboxName:r().string,children:r().node,label:r().string.isRequired,isCollapsable:r().bool,isFormDisabled:r().bool.isRequired,onChange:r().func,onClick:r().func.isRequired,someChecked:r().bool,value:r().bool,isActive:r().bool.isRequired};var He=(0,e.memo)(Oe);const We=t=>(0,g.isObject)(t)?(0,g.flattenDeep)(Object.values(t).map(n=>(0,g.isObject)(n)?We(n):n)):[];var Ce=We,$e=t=>t?Object.keys(t).reduce((n,o)=>(o!=="conditions"&&(n[o]=t[o]),n),{}):null,de=t=>{const n=$e(t),o=Ce(n);if(!o.length)return{hasAllActionsSelected:!1,hasSomeActionsSelected:!1};const s=o.every(a=>a),i=o.some(a=>a)&&!s;return{hasAllActionsSelected:s,hasSomeActionsSelected:i}},vt=(t,n,o)=>t.map(({actionId:s,isDisplayed:i,applyToProperties:a,label:c})=>{if(!i)return{actionId:s,hasSomeActionsSelected:!1,isDisplayed:i};const d=[...o.split(".."),s],p=(0,g.isEmpty)(a)?[...d,"properties","enabled"]:d,m=p.join(".."),f=(0,g.get)(n,[...d,"conditions"],null),h=Ce(f).some(b=>b);if((0,g.isEmpty)(a)){const b=(0,g.get)(n,p,!1);return{actionId:s,checkboxName:m,hasAllActionsSelected:b,hasConditions:h,hasSomeActionsSelected:b,isDisplayed:i,isParentCheckbox:!1,label:c,pathToConditionsObject:d}}const v=(0,g.get)(n,p,null),{hasAllActionsSelected:k,hasSomeActionsSelected:x}=de(v);return{actionId:s,checkboxName:m,hasAllActionsSelected:k,hasConditions:h,hasSomeActionsSelected:x,isDisplayed:i,isParentCheckbox:!0,label:c,pathToConditionsObject:d}}),xe=(0,E.default)(_.CarretDown)`
  display: none;
  width: ${10/16}rem;
  transform: rotate(${({$isActive:t})=>t?"180":"0"}deg);
  margin-left: ${({theme:t})=>t.spaces[2]};
`,Re=t=>`
  ${l.Typography} {
    color: ${t.colors.primary600};
    font-weight: ${t.fontWeights.bold}
  }
  ${xe} {
    display: block;
    path {
      fill: ${t.colors.primary600}
    };
  }
`;const Me=(t,n)=>`
  ${Ke} {
    background-color: ${t.colors.primary100};
    color: ${t.colors.primary600};
    border-radius: ${n?"2px 2px 0 0":"2px"};
  }
  ${Ze} {
    display: flex;
  }
  ${ce} {
    display: block;
  }
  &:hover {
   ${Re(t)}
  }

  &:focus-within {
    ${({theme:o,isActive:s})=>Me(o,s)}
  }
  
`,Ke=E.default.div`
  flex: 1;
  display: flex;
  align-items: center;
  height: ${M};
  background-color: ${({isGrey:t,theme:n})=>t?n.colors.neutral100:n.colors.neutral0};
  border: 1px solid transparent;
`,xt=E.default.div`
  display: inline-flex;
  min-width: 100%;

  ${ce} {
    display: none;
  }
  ${({isActive:t,theme:n})=>t&&Me(n,t)}
  &:hover {
    ${({theme:t,isActive:n})=>Me(t,n)}
  }
`,Ue=(0,E.default)(l.Flex)`
  width: ${K};
  position: relative;
`,Ze=(0,E.default)(l.Box)`
  display: none;
  svg {
    width: 11px;
  }
  * {
    fill: ${({theme:t})=>t.colors.primary600};
  }
`,Xe=E.default.span`
  position: absolute;
  top: -6px;
  left: 37px;
  width: 6px;
  height: 6px;
  border-radius: 20px;
  background: ${({theme:t})=>t.colors.primary600};
`,Rt=(0,E.default)(l.Box)`
  position: absolute;
  right: 9px;
  transform: translateY(10px);
`,Ye=({availableActions:t,isActive:n,isGrey:o,isFormDisabled:s,label:i,onClickToggle:a,pathToData:c})=>{const[d,p]=(0,e.useState)(!1),{formatMessage:m}=(0,L.useIntl)(),{modifiedData:f,onChangeParentCheckbox:h,onChangeSimpleCheckbox:v}=(0,ee.$_)(),k=()=>{p(F=>!F)},x=()=>{p(!1)},b=G()(f,c.split(".."),{}),y=(0,e.useMemo)(()=>Object.keys(b).reduce((F,I)=>(F[I]=ke()(b[I],"conditions"),F),{}),[b]),{hasAllActionsSelected:T,hasSomeActionsSelected:R}=de(y),S=(0,e.useMemo)(()=>vt(t,f,c),[t,f,c]),N=S.some(({hasConditions:F})=>F);return e.createElement(xt,{isActive:n},e.createElement(Ke,{isGrey:o},e.createElement(He,{isCollapsable:!0,isFormDisabled:s,label:i,checkboxName:c,onChange:h,onClick:a,someChecked:R,value:T,isActive:n},e.createElement(Ze,{paddingLeft:2},n?e.createElement(_.ChevronUp,null):e.createElement(_.ChevronDown,null))),e.createElement(l.Flex,{style:{flex:1}},S.map(({actionId:F,hasConditions:I,hasAllActionsSelected:$,hasSomeActionsSelected:Y,isDisplayed:be,isParentCheckbox:H,checkboxName:re,label:Te})=>be?H?e.createElement(Ue,{key:F,justifyContent:"center",alignItems:"center"},I&&e.createElement(Xe,null),e.createElement(l.BaseCheckbox,{disabled:s,name:re,"aria-label":m({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${Te} ${i}`}),onValueChange:ue=>{h({target:{name:re,value:ue}})},indeterminate:Y,value:$})):e.createElement(Ue,{key:F,justifyContent:"center",alignItems:"center"},I&&e.createElement(Xe,null),e.createElement(l.BaseCheckbox,{disabled:s,indeterminate:I,name:re,onValueChange:ue=>{v({target:{name:re,value:ue}})},value:$})):e.createElement(se,{key:F}))),d&&e.createElement(he,{headerBreadCrumbs:[i,"Settings.permissions.conditions.conditions"],actions:S,isFormDisabled:s,onClosed:x,onToggle:k})),e.createElement(Rt,null,e.createElement(ce,{onClick:k,hasConditions:N})))};Ye.propTypes={availableActions:r().array.isRequired,isActive:r().bool.isRequired,isGrey:r().bool.isRequired,isFormDisabled:r().bool.isRequired,label:r().string.isRequired,onClickToggle:r().func.isRequired,pathToData:r().string.isRequired};var Tt=Ye,St=(t,n)=>t.map(o=>{const s=Array.isArray(o.applyToProperties)&&o.applyToProperties.indexOf(n)!==-1&&o.isDisplayed;return{label:o.label,actionId:o.actionId,isActionRelatedToCurrentProperty:s}});const ze=(0,E.default)(l.Flex)`
  width: ${K};
  flex-shrink: 0;
`,At=(0,E.default)(l.Flex)`
  width: ${O};
  height: ${M};
  flex-shrink: 0;
`,Je=({headers:t,label:n})=>{const{formatMessage:o}=(0,L.useIntl)(),s=o({id:"Settings.roles.form.permission.property-label",defaultMessage:"{label} permissions"},{label:n});return e.createElement(l.Flex,null,e.createElement(At,{alignItems:"center",paddingLeft:6},e.createElement(l.Typography,{variant:"sigma",textColor:"neutral500"},s)),t.map(i=>i.isActionRelatedToCurrentProperty?e.createElement(ze,{justifyContent:"center",key:i.label},e.createElement(l.Typography,{variant:"sigma",textColor:"neutral500"},o({id:`Settings.roles.form.permissions.${i.label.toLowerCase()}`,defaultMessage:i.label}))):e.createElement(ze,{key:i.label})))};Je.propTypes={headers:r().arrayOf(r().shape({label:r().string.isRequired,isActionRelatedToCurrentProperty:r().bool.isRequired})).isRequired,label:r().string.isRequired};var Pt=Je;const kt=E.default.span`
  color: ${({theme:t})=>t.colors.danger700};
  padding-left: ${({theme:t})=>t.spaces[1]}px;
`;var Qe=()=>e.createElement(kt,null,"*"),Ot=(t,n)=>t.map(o=>{const s=Array.isArray(o.subjects)&&o.subjects.indexOf(n)!==-1;return{...o,isDisplayed:s}});const $t=(0,E.default)(l.Box)`
  transform: translate(-4px, -12px);

  &:before {
    content: '';
    width: ${4/16}rem;
    height: ${12/16}rem;
    background: ${({theme:t})=>t.colors.primary200};
    display: block;
  }
`,Mt=E.default.svg`
  position: relative;
  flex-shrink: 0;
  transform: translate(-0.5px, -1px);

  * {
    fill: ${({theme:t,color:n})=>t.colors[n]};
  }
`,Fe=t=>e.createElement($t,null,e.createElement(Mt,{width:"20",height:"23",viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.02477 14.7513C8.65865 17.0594 11.6046 18.6059 17.5596 18.8856C18.6836 18.9384 19.5976 19.8435 19.5976 20.9688V20.9688C19.5976 22.0941 18.6841 23.0125 17.5599 22.9643C10.9409 22.6805 6.454 20.9387 3.75496 17.1258C0.937988 13.1464 0.486328 7.39309 0.486328 0.593262H4.50974C4.50974 7.54693 5.06394 11.9813 7.02477 14.7513Z",fill:"#D9D8FF"})));Fe.defaultProps={fill:"primary200"},Fe.propTypes={fill:r().string};var Ft=(0,e.memo)(Fe);const _e=(0,E.default)(l.Flex)`
  width: ${K};
  position: relative;
`,Lt=(0,E.default)(l.Flex)`
  height: ${M};
`,Bt=(0,E.default)(l.Box)`
  padding-left: ${31/16}rem;
`,jt=(0,E.default)(l.Box)`
  border-left: ${({isVisible:t,theme:n})=>t?`4px solid ${n.colors.primary200}`:"4px solid transparent"};
`,Dt=(0,E.default)(l.Flex)`
  padding-left: ${({theme:t})=>t.spaces[4]};
  width: ${({level:t})=>145-t*36}px;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${xe} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${Re(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&Re(n)};
`,It=E.default.div`
  padding-top: ${({theme:t})=>t.spaces[2]};
  margin-top: ${({theme:t})=>t.spaces[2]};
  width: ${4/16}rem;
  background-color: ${({theme:t})=>t.colors.primary200};
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
`,Le=({childrenForm:t,isFormDisabled:n,recursiveLevel:o,pathToDataFromActionRow:s,propertyActions:i,parentName:a,propertyName:c})=>{const{formatMessage:d}=(0,L.useIntl)(),{modifiedData:p,onChangeParentCheckbox:m,onChangeSimpleCheckbox:f}=(0,ee.$_)(),[h,v]=(0,e.useState)(null),k=b=>{v(y=>y===b?null:b)},x=(0,e.useMemo)(()=>h?t.find(({value:b})=>b===h):null,[h,t]);return e.createElement(Bt,null,e.createElement(It,null),t.map(({label:b,value:y,required:T,children:R},S)=>{const N=S+1<t.length,F=Array.isArray(R),I=h===y;return e.createElement(jt,{key:y,isVisible:N},e.createElement(Lt,null,e.createElement(Ft,{color:"primary200"}),e.createElement(l.Flex,{style:{flex:1}},e.createElement(Dt,{level:o,isActive:I,isCollapsable:F},e.createElement(Ge,{alignItems:"center",isCollapsable:F,...F&&{onClick:()=>k(y),"aria-expanded":I,onKeyDown:({key:$})=>($==="Enter"||$===" ")&&k(y),tabIndex:0,role:"button"},title:b},e.createElement(l.Typography,{ellipsis:!0},q()(b)),T&&e.createElement(Qe,null),e.createElement(xe,{$isActive:I}))),e.createElement(l.Flex,{style:{flex:1}},i.map(({actionId:$,label:Y,isActionRelatedToCurrentProperty:be})=>{if(!be)return e.createElement(se,{key:$});const H=[...s.split(".."),$,"properties",c,...a.split(".."),y],re=G()(p,H,!1);if(!R)return e.createElement(_e,{key:Y,justifyContent:"center",alignItems:"center"},e.createElement(l.BaseCheckbox,{disabled:n,name:H.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${a} ${b} ${Y}`}),onValueChange:me=>{f({target:{name:H.join(".."),value:me}})},value:re}));const{hasAllActionsSelected:Te,hasSomeActionsSelected:ue}=de(re);return e.createElement(_e,{key:Y,justifyContent:"center",alignItems:"center"},e.createElement(l.BaseCheckbox,{key:Y,disabled:n,name:H.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${a} ${b} ${Y}`}),onValueChange:me=>{m({target:{name:H.join(".."),value:me}})},value:Te,indeterminate:ue}))})))),x&&I&&e.createElement(l.Box,{paddingBottom:2},e.createElement(Le,{isFormDisabled:n,parentName:`${a}..${y}`,pathToDataFromActionRow:s,propertyActions:i,propertyName:c,recursiveLevel:o+1,childrenForm:x.children})))}))};Le.propTypes={childrenForm:r().array.isRequired,isFormDisabled:r().bool.isRequired,parentName:r().string.isRequired,pathToDataFromActionRow:r().string.isRequired,propertyActions:r().array.isRequired,propertyName:r().string.isRequired,recursiveLevel:r().number.isRequired};var qt=(0,e.memo)(Le);const wt=t=>t.reduce((o,s)=>(s.isActionRelatedToCurrentProperty&&o.push(s.actionId),o),[]);var Nt=(t,n,o,s,i)=>{const c=wt(t).reduce((d,p)=>{const m=[...o.split(".."),p,"properties",s,i],f=(0,g.get)(n,m,!1);return d[p]=f,d},{});return de(c)};const et=(0,E.default)(l.Flex)`
  width: ${K};
  position: relative;
`,Vt=(0,E.default)(l.Flex)`
  height: ${M};
  flex: 1;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${xe} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${Re(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&Re(n)};
`,Be=({childrenForm:t,label:n,isFormDisabled:o,name:s,required:i,pathToData:a,propertyActions:c,propertyName:d,isOdd:p})=>{const{formatMessage:m}=(0,L.useIntl)(),[f,h]=(0,e.useState)(null),{modifiedData:v,onChangeCollectionTypeLeftActionRowCheckbox:k,onChangeParentCheckbox:x,onChangeSimpleCheckbox:b}=(0,ee.$_)(),y=f===s,T=(0,e.useMemo)(()=>Array.isArray(t)?t:[],[t]),R=T.length>0,S=(0,e.useCallback)(()=>{R&&h($=>$===s?null:s)},[R,s]),N=({target:{value:$}})=>{k(a,d,s,$)},{hasAllActionsSelected:F,hasSomeActionsSelected:I}=(0,e.useMemo)(()=>Nt(c,v,a,d,s),[c,v,a,d,s]);return e.createElement(e.Fragment,null,e.createElement(Vt,{alignItems:"center",isCollapsable:R,isActive:y,background:p?"neutral100":"neutral0"},e.createElement(l.Flex,null,e.createElement(He,{onChange:N,onClick:S,isCollapsable:R,isFormDisabled:o,label:n,someChecked:I,value:F,isActive:y},i&&e.createElement(Qe,null),e.createElement(xe,{$isActive:y})),e.createElement(l.Flex,null,c.map(({label:$,isActionRelatedToCurrentProperty:Y,actionId:be})=>{if(!Y)return e.createElement(se,{key:$});const H=[...a.split(".."),be,"properties",d,s];if(!R){const me=G()(v,H,!1);return e.createElement(et,{key:be,justifyContent:"center",alignItems:"center"},e.createElement(l.BaseCheckbox,{disabled:o,name:H.join(".."),"aria-label":m({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${$}`}),onValueChange:Sn=>{b({target:{name:H.join(".."),value:Sn}})},value:me}))}const re=G()(v,H,{}),{hasAllActionsSelected:Te,hasSomeActionsSelected:ue}=de(re);return e.createElement(et,{key:$,justifyContent:"center",alignItems:"center"},e.createElement(l.BaseCheckbox,{disabled:o,name:H.join(".."),onValueChange:me=>{x({target:{name:H.join(".."),value:me}})},"aria-label":m({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${$}`}),value:Te,indeterminate:ue}))})))),y&&e.createElement(qt,{childrenForm:T,isFormDisabled:o,parentName:s,pathToDataFromActionRow:a,propertyName:d,propertyActions:c,recursiveLevel:0}))};Be.defaultProps={childrenForm:[],required:!1},Be.propTypes={childrenForm:r().array,label:r().string.isRequired,isFormDisabled:r().bool.isRequired,name:r().string.isRequired,pathToData:r().string.isRequired,propertyActions:r().array.isRequired,propertyName:r().string.isRequired,required:r().bool,isOdd:r().bool.isRequired};var Gt=(0,e.memo)(Be);const Ht=E.default.div`
  display: inline-flex;
  flex-direction: column;
  min-width: 0;
`,tt=({availableActions:t,childrenForm:n,isFormDisabled:o,label:s,pathToData:i,propertyName:a})=>{const c=(0,e.useMemo)(()=>St(t,a),[t,a]);return e.createElement(Ht,null,e.createElement(Pt,{label:s,headers:c}),e.createElement(l.Box,null,n.map(({children:d,label:p,value:m,required:f},h)=>e.createElement(Gt,{childrenForm:d,key:m,label:p,isFormDisabled:o,name:m,required:f,propertyActions:c,pathToData:i,propertyName:a,isOdd:h%2===0}))))};tt.propTypes={childrenForm:r().array.isRequired,availableActions:r().array.isRequired,isFormDisabled:r().bool.isRequired,label:r().string.isRequired,pathToData:r().string.isRequired,propertyName:r().string.isRequired};var Wt=tt;const Kt=E.default.div`
  flex-direction: column;
  display: inline-flex;
  min-width: 100%;
  ${({theme:t,isActive:n})=>n&&`border: 1px solid ${t.colors.primary600};`}
`,nt=({allActions:t,contentTypeName:n,label:o,index:s,isActive:i,isFormDisabled:a,onClickToggleCollapse:c,pathToData:d,properties:p})=>{const m=(0,e.useCallback)(()=>{c(n)},[n,c]),f=(0,e.useMemo)(()=>Ot(t,n),[t,n]);return e.createElement(Kt,{isActive:i},e.createElement(Tt,{availableActions:f,isActive:i,isGrey:s%2===0,isFormDisabled:a,label:o,onClickToggle:m,pathToData:d}),i&&p.map(({label:h,value:v,children:k})=>e.createElement(Wt,{availableActions:f,childrenForm:k,isFormDisabled:a,label:h,pathToData:d,propertyName:v,key:v})))};nt.propTypes={allActions:r().array.isRequired,contentTypeName:r().string.isRequired,index:r().number.isRequired,isActive:r().bool.isRequired,isFormDisabled:r().bool.isRequired,label:r().string.isRequired,onClickToggleCollapse:r().func.isRequired,pathToData:r().string.isRequired,properties:r().array.isRequired};var Ut=nt;const je=({actions:t,isFormDisabled:n,pathToData:o,subjects:s})=>{const[i,a]=(0,e.useState)(null),c=d=>{a(i===d?null:d)};return s.map(({uid:d,label:p,properties:m},f)=>e.createElement(Ut,{allActions:t,key:d,contentTypeName:d,label:p,isActive:i===d,isFormDisabled:n,index:f,onClickToggleCollapse:c,pathToData:`${o}..${d}`,properties:m}))};je.defaultProps={actions:[],subjects:[]},je.propTypes={actions:r().array.isRequired,isFormDisabled:r().bool.isRequired,pathToData:r().string.isRequired,subjects:r().arrayOf(r().shape({uid:r().string.isRequired,label:r().string.isRequired,properties:r().array.isRequired}))};var Zt=(0,e.memo)(je),Xt=t=>t.filter(({subjects:n})=>n&&n.length);const Yt=t=>t.map(({actionId:n})=>n),zt=(t,n)=>t.reduce((o,s)=>(Object.keys(n).forEach(i=>{const a=(0,g.get)(n,[i,s],{}),c={[i]:$e(a)};o[s]?o[s]={...o[s],...c}:o[s]=c}),o),{});var Jt=(t,n)=>{const o=Yt(t),s=zt(o,n);return Object.keys(s).reduce((a,c)=>(a[c]=de(s[c]),a),{})};const Qt=(0,E.default)(l.Flex)`
  width: ${K};
  flex-shrink: 0;
`,De=({actions:t,isFormDisabled:n,kind:o})=>{const{formatMessage:s}=(0,L.useIntl)(),{modifiedData:i,onChangeCollectionTypeGlobalActionCheckbox:a}=(0,ee.$_)(),c=(0,e.useMemo)(()=>Xt(t),[t]),d=(0,e.useMemo)(()=>Jt(c,i[o]),[i,c,o]);return e.createElement(l.Box,{paddingBottom:4,paddingTop:6,style:{paddingLeft:O}},e.createElement(l.Flex,{gap:0},c.map(({label:p,actionId:m})=>e.createElement(Qt,{direction:"column",alignItems:"center",justifyContent:"center",key:m,gap:3},e.createElement(l.Typography,{variant:"sigma",textColor:"neutral500"},s({id:`Settings.roles.form.permissions.${p.toLowerCase()}`,defaultMessage:p})),e.createElement(l.BaseCheckbox,{disabled:n,onValueChange:f=>{a(o,m,f)},name:m,"aria-label":s({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:s({id:`Settings.roles.form.permissions.${p.toLowerCase()}`,defaultMessage:p})}),value:G()(d,[m,"hasAllActionsSelected"],!1),indeterminate:G()(d,[m,"hasSomeActionsSelected"],!1)})))))};De.defaultProps={actions:[]},De.propTypes={actions:r().arrayOf(r().shape({label:r().string.isRequired,actionId:r().string.isRequired,subjects:r().array.isRequired})),isFormDisabled:r().bool.isRequired,kind:r().string.isRequired};var _t=(0,e.memo)(De);const en=(0,E.default)(l.Box)`
  overflow-x: auto;
`,st=({isFormDisabled:t,kind:n,layout:{actions:o,subjects:s}})=>{const i=Q()([...s],"label");return e.createElement(en,{background:"neutral0"},e.createElement(_t,{actions:o,kind:n,isFormDisabled:t}),e.createElement(Zt,{actions:o,isFormDisabled:t,pathToData:n,subjects:i}))};st.propTypes={isFormDisabled:r().bool.isRequired,kind:r().string.isRequired,layout:r().shape({actions:r().array,subjects:r().arrayOf(r().shape({uid:r().string.isRequired,label:r().string.isRequired,properties:r().array.isRequired}))}).isRequired};var ot=(0,e.memo)(st),tn=u(66694);const rt=({children:t,value:n})=>e.createElement(tn.$l.Provider,{value:n},t);rt.propTypes={children:r().node.isRequired,value:r().exact({availableConditions:r().array.isRequired,modifiedData:r().object.isRequired,onChangeCollectionTypeLeftActionRowCheckbox:r().func.isRequired,onChangeConditions:r().func.isRequired,onChangeSimpleCheckbox:r().func.isRequired,onChangeParentCheckbox:r().func.isRequired,onChangeCollectionTypeGlobalActionCheckbox:r().func.isRequired}).isRequired};var nn=rt,sn=(t,n,o)=>t.map(s=>{const i=[...o,s.action,"properties","enabled"],a=(0,g.get)(n,i,!1),c=(0,g.get)(n,[...o,s.action,"conditions"],{}),d=Ce(c).some(p=>p);return{...s,isDisplayed:a,checkboxName:i.join(".."),hasSomeActionsSelected:a,value:a,hasConditions:d,label:s.displayName,actionId:s.action,pathToConditionsObject:[...o,s.action]}}),on=t=>{const n=Object.entries(t).reduce((s,i)=>{const[a,{conditions:c}]=i;return s[a]=c,s},{});return Ce(n).some(s=>s)};const rn=E.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,an=E.default.div`
  position: relative;
  word-break: keep-all;
  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: ${-4/16}rem;
      left: ${-8/16}rem;
      width: ${6/16}rem;
      height: ${6/16}rem;
      border-radius: ${20/16}rem;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,it=({categoryName:t,isFormDisabled:n,subCategoryName:o,actions:s,pathToData:i})=>{const[a,c]=(0,e.useState)(!1),{modifiedData:d,onChangeParentCheckbox:p,onChangeSimpleCheckbox:m}=(0,ee.$_)(),{formatMessage:f}=(0,L.useIntl)(),h=G()(d,i,{}),v=(0,e.useMemo)(()=>Object.keys(h).reduce((S,N)=>(S[N]=$e(h[N]),S),{}),[h]),{hasAllActionsSelected:k,hasSomeActionsSelected:x}=de(v),b=()=>{c(S=>!S)},y=()=>{c(!1)},T=sn(s,d,i),R=on(G()(d,[...i],{}));return e.createElement(e.Fragment,null,e.createElement(l.Box,null,e.createElement(l.Flex,{justifyContent:"space-between",alignItems:"center"},e.createElement(l.Box,{paddingRight:4},e.createElement(l.Typography,{variant:"sigma",textColor:"neutral600"},o)),e.createElement(rn,null),e.createElement(l.Box,{paddingLeft:4},e.createElement(l.Checkbox,{name:i.join(".."),disabled:n,onValueChange:S=>{p({target:{name:i.join(".."),value:S}})},indeterminate:x,value:k},f({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(l.Flex,{paddingTop:6,paddingBottom:6},e.createElement(l.Grid,{gap:2,style:{flex:1}},T.map(({checkboxName:S,value:N,action:F,displayName:I,hasConditions:$})=>e.createElement(l.GridItem,{col:3,key:F},e.createElement(an,{disabled:n,hasConditions:$},e.createElement(l.Checkbox,{name:S,disabled:n,onValueChange:Y=>{m({target:{name:S,value:Y}})},value:N},I))))),e.createElement(ce,{hasConditions:R,onClick:b}))),a&&e.createElement(he,{headerBreadCrumbs:[t,o],actions:T,isFormDisabled:n,onClosed:y,onToggle:b}))};it.propTypes={actions:r().array.isRequired,categoryName:r().string.isRequired,isFormDisabled:r().bool.isRequired,subCategoryName:r().string.isRequired,pathToData:r().array.isRequired};var ln=it;const Ie=({childrenForm:t,kind:n,name:o,isOpen:s,isFormDisabled:i,isWhite:a,onOpenCategory:c,pathToData:d})=>{const{formatMessage:p}=(0,L.useIntl)(),m=()=>{c(o)},f=(0,e.useMemo)(()=>o.split("::").pop(),[o]);return e.createElement(l.Accordion,{expanded:s,onToggle:m,id:`accordion-${o}`,variant:a?"primary":"secondary"},e.createElement(l.AccordionToggle,{title:q()(f),description:`${p({id:"Settings.permissions.category"},{category:f})} ${n==="plugins"?"plugin":n}`}),e.createElement(l.AccordionContent,null,e.createElement(l.Box,{padding:6},t.map(({actions:h,subCategoryName:v,subCategoryId:k})=>e.createElement(ln,{key:v,actions:h,categoryName:f,isFormDisabled:i,subCategoryName:v,pathToData:[...d,k]})))))};Ie.defaultProps={},Ie.propTypes={childrenForm:r().array.isRequired,isOpen:r().bool.isRequired,isFormDisabled:r().bool.isRequired,isWhite:r().bool.isRequired,kind:r().string.isRequired,name:r().string.isRequired,onOpenCategory:r().func.isRequired,pathToData:r().array.isRequired};var cn=Ie;const at=({isFormDisabled:t,kind:n,layout:o})=>{const[s,i]=(0,e.useState)(null),a=c=>{i(c===s?null:c)};return e.createElement(l.Box,{padding:6,background:"neutral0"},o.map(({category:c,categoryId:d,childrenForm:p},m)=>e.createElement(cn,{key:c,childrenForm:p,kind:n,isFormDisabled:t,isOpen:s===c,isWhite:m%2===1,name:c,onOpenCategory:a,pathToData:[n,d]})))};at.propTypes={isFormDisabled:r().bool.isRequired,kind:r().string.isRequired,layout:r().arrayOf(r().shape({category:r().string.isRequired,categoryId:r().string.isRequired,childrenForm:r().arrayOf(r().shape({actions:r().array.isRequired})).isRequired}).isRequired).isRequired};var lt=at,ct=(t,n,o)=>t.find(s=>s.action===n&&s.subject===o);const dt=(t,n=[])=>t.reduce((o,s)=>(o[s.id]=n.indexOf(s.id)!==-1,o),{}),ut=({children:t},n,o="")=>t.reduce((s,i)=>{if(i.children)return{...s,[i.value]:ut(i,n,`${o}${i.value}.`)};const a=n.indexOf(`${o}${i.value}`)!==-1;return s[i.value]=a,s},{}),dn=(t,n,o)=>t.reduce((s,i)=>{const a=n.properties.find(({value:c})=>c===i);if(a){const c=(0,g.get)(o,["properties",a.value],[]),d=ut(a,c);s.properties[i]=d}return s},{properties:{}}),un=(t,n)=>n.reduce((o,s)=>{const i=t.find(({uid:a})=>a===s)||null;return i&&(o[s]=i),o},{});var mt=({subjects:t},n,o,s=[])=>n.reduce((i,a)=>{const c=a.subjects,d=un(t,c);if((0,g.isEmpty)(d))return i;const p=Object.keys(d).reduce((m,f)=>{const{actionId:h,applyToProperties:v}=a,b=d[f].properties.map(({value:S})=>S).every(S=>(v||[]).indexOf(S)===-1),y=ct(s,h,f),T=dt(o,(0,g.get)(y,"conditions",[]));if((0,g.isEmpty)(v)||b)return(0,g.set)(m,[f,h],{properties:{enabled:y!==void 0},conditions:T}),m;const R=dn(v,d[f],y);return(0,g.set)(m,[f,h],{...R,conditions:T}),m},{});return(0,g.merge)(i,p)},{});const mn=(t,n,o)=>t.reduce((s,i)=>{const a=ct(o,i.action,null);return s[i.action]={properties:{enabled:a!==void 0},conditions:dt(n,(0,g.get)(a,"conditions",[]))},s},{}),pn=(t,n,o)=>t.reduce((s,i)=>(s[i.subCategoryId]=mn(i.actions,n,o),s),{});var pt=(t,n,o=[])=>t.reduce((s,{categoryId:i,childrenForm:a})=>{const c=pn(a,n,o);return s[i]=c,s},{});const gt=t=>t.split(" ").join("-");var ft=(t,n)=>Object.entries(j()(t,n)).map(([o,s])=>({category:o,categoryId:gt(o),childrenForm:Object.entries(j()(s,"subCategory")).map(([i,a])=>({subCategoryName:i,subCategoryId:gt(i),actions:a}))})),gn=(t,n)=>{const{conditions:o,sections:{collectionTypes:s,singleTypes:i,plugins:a,settings:c}}=t,d={collectionTypes:s,singleTypes:i,plugins:ft(a,"plugin"),settings:ft(c,"category")},p={collectionTypes:mt(s,s.actions||[],o,n),singleTypes:mt(i,i.actions||[],o,n),plugins:pt(d.plugins,o,n),settings:pt(d.settings,o,n)};return{initialData:p,modifiedData:p,layouts:d}};const yt=t=>Object.keys(t).reduce((n,o)=>{const s=t[o];if((0,g.isObject)(s)&&!(0,g.has)(s,"conditions"))return{...n,[o]:yt(s)};if((0,g.isObject)(s)&&(0,g.has)(s,"conditions")&&!Ce((0,g.omit)(s,"conditions")).some(a=>a)){const a=Object.keys(s.conditions).reduce((c,d)=>(c[d]=!1,c),{});return{...n,[o]:{...s,conditions:a}}}return n[o]=s,n},{});var qe=yt;const ht=(t,n)=>Object.keys(t).reduce((o,s)=>{const i=t[s];return s==="conditions"?(o[s]=i,o):(0,g.isObject)(i)?{...o,[s]:ht(i,n)}:(o[s]=n,o)},{});var Pe=ht;const fn={initialData:{},modifiedData:{},layouts:{}};var yn=(t,n)=>(0,B.default)(t,o=>{switch(n.type){case"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX":{const{collectionTypeKind:s,actionId:i,value:a}=n,c=["modifiedData",s];Object.keys((0,g.get)(t,c)).forEach(d=>{const p=(0,g.get)(t,[...c,d,i],void 0);if(p){let m=Pe(p,a);if(!a&&m.conditions){const f=Pe(m.conditions,!1);m={...m,conditions:f}}(0,g.set)(o,[...c,d,i],m)}});break}case"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX":{const{pathToCollectionType:s,propertyName:i,rowName:a,value:c}=n;let d=(0,g.cloneDeep)(t.modifiedData);const p=s.split(".."),m=(0,g.get)(d,p,{});Object.keys(m).forEach(f=>{if((0,g.has)(m[f],`properties.${i}`)){const h=(0,g.get)(m,[f,"properties",i,a]),v=[...p,f,"properties",i,a];if(!(0,g.isObject)(h))(0,g.set)(d,v,c);else{const k=Pe(h,c);(0,g.set)(d,v,k)}}}),c||(d=qe(d)),(0,g.set)(o,"modifiedData",d);break}case"ON_CHANGE_CONDITIONS":{Object.entries(n.conditions).forEach(s=>{const[i,a]=s;(0,g.set)(o,["modifiedData",...i.split(".."),"conditions"],a)});break}case"ON_CHANGE_SIMPLE_CHECKBOX":{let s=(0,g.cloneDeep)(t.modifiedData);(0,g.set)(s,[...n.keys.split("..")],n.value),n.value||(s=qe(s)),(0,g.set)(o,"modifiedData",s);break}case"ON_CHANGE_TOGGLE_PARENT_CHECKBOX":{const{keys:s,value:i}=n,a=[...s.split("..")];let c=(0,g.cloneDeep)(t.modifiedData);const d=(0,g.get)(c,a,{}),p=Pe(d,i);(0,g.set)(c,a,p),i||(c=qe(c)),(0,g.set)(o,["modifiedData"],c);break}case"RESET_FORM":{o.modifiedData=t.initialData;break}case"SET_FORM_AFTER_SUBMIT":{o.initialData=t.modifiedData;break}default:return o}});const we=t=>Object.entries(t).filter(([,n])=>n).map(([n])=>n),hn=t=>{const[n,{conditions:o}]=t;return{action:n,subject:null,conditions:we(o),properties:{}}},Cn=t=>Object.values(t).reduce((n,o)=>{const s=Object.entries(o).reduce((i,a)=>{const[,{properties:{enabled:c}}]=a;if(!c)return i;const d=hn(a);return i.push(d),i},[]);return[...n,...s]},[]);var Ct=t=>Object.values(t).reduce((n,o)=>{const s=Cn(o);return[...n,...s]},[]);const bt=(t,n="")=>Object.entries(t).reduce((o,s)=>{const[i,a]=s;return(0,g.isObject)(a)?[...o,...bt(a,`${n}${i}.`)]:(a&&!(0,g.isObject)(a)&&o.push(`${n}${i}`),o)},[]),bn=(t,n,{conditions:o,properties:s})=>Object.entries(s).reduce((i,a)=>{const[c,d]=a;return i.properties[c]=bt(d),i},{action:t,subject:n,conditions:we(o),properties:{}}),En=(t,n,{conditions:o})=>({action:t,subject:n,properties:{},conditions:we(o)}),vn=(t,n)=>Object.entries(n).reduce((s,i)=>{const[a,c]=i;if(!Ce(c).some(m=>m))return s;if(!(0,g.has)(c,"properties.enabled")){const m=bn(a,t,c);return[...s,m]}if(!c.properties.enabled)return s;const p=En(a,t,c);return s.push(p),s},[]);var Et=t=>Object.entries(t).reduce((o,s)=>{const[i,a]=s,c=vn(i,a);return[...o,...c]},[]),xn=t=>{const n=Ct(t.plugins),o=Ct(t.settings),s=Et(t.collectionTypes),i=Et(t.singleTypes);return[...n,...o,...s,...i]},Rn=[{labelId:"app.components.LeftMenuLinkContainer.collectionTypes",defaultMessage:"Collection Types",id:"collectionTypes"},{labelId:"app.components.LeftMenuLinkContainer.singleTypes",id:"singleTypes",defaultMessage:"Single Types"},{labelId:"app.components.LeftMenuLinkContainer.plugins",defaultMessage:"Plugins",id:"plugins"},{labelId:"app.components.LeftMenuLinkContainer.settings",defaultMessage:"Settings",id:"settings"}];const Ne=(0,e.forwardRef)(({layout:t,isFormDisabled:n,permissions:o},s)=>{const[{initialData:i,layouts:a,modifiedData:c},d]=(0,e.useReducer)(yn,fn,()=>gn(t,o)),{formatMessage:p}=(0,L.useIntl)();(0,e.useImperativeHandle)(s,()=>({getPermissions(){const x=(0,C.difference)(i.collectionTypes,c.collectionTypes),b=(0,C.difference)(i.singleTypes,c.singleTypes),y={...x,...b};let T;return J()(y)?T=!1:T=Object.values(y).some(R=>Object.values(R).some(S=>V()(S,"conditions"))),{permissionsToSend:xn(c),didUpdateConditions:T}},resetForm(){d({type:"RESET_FORM"})},setFormAfterSubmit(){d({type:"SET_FORM_AFTER_SUBMIT"})}}));const m=(x,b,y,T)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX",pathToCollectionType:x,propertyName:b,rowName:y,value:T})},f=(x,b,y)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX",collectionTypeKind:x,actionId:b,value:y})},h=x=>{d({type:"ON_CHANGE_CONDITIONS",conditions:x})},v=(0,e.useCallback)(({target:{name:x,value:b}})=>{d({type:"ON_CHANGE_SIMPLE_CHECKBOX",keys:x,value:b})},[]),k=(0,e.useCallback)(({target:{name:x,value:b}})=>{d({type:"ON_CHANGE_TOGGLE_PARENT_CHECKBOX",keys:x,value:b})},[]);return e.createElement(nn,{value:{availableConditions:t.conditions,modifiedData:c,onChangeConditions:h,onChangeSimpleCheckbox:v,onChangeParentCheckbox:k,onChangeCollectionTypeLeftActionRowCheckbox:m,onChangeCollectionTypeGlobalActionCheckbox:f}},e.createElement(l.TabGroup,{id:"tabs",label:p({id:"Settings.permissions.users.tabs.label",defaultMessage:"Tabs Permissions"})},e.createElement(l.Tabs,null,Rn.map(x=>e.createElement(l.Tab,{key:x.id},p({id:x.labelId,defaultMessage:x.defaultMessage})))),e.createElement(l.TabPanels,{style:{position:"relative"}},e.createElement(l.TabPanel,null,e.createElement(ot,{layout:a.collectionTypes,kind:"collectionTypes",isFormDisabled:n})),e.createElement(l.TabPanel,null,e.createElement(ot,{layout:a.singleTypes,kind:"singleTypes",isFormDisabled:n})),e.createElement(l.TabPanel,null,e.createElement(lt,{layout:a.plugins,kind:"plugins",isFormDisabled:n})),e.createElement(l.TabPanel,null,e.createElement(lt,{layout:a.settings,kind:"settings",isFormDisabled:n})))))});Ne.defaultProps={permissions:[],layout:{conditions:[],sections:{collectionTypes:{},singleTypes:{actions:[]},settings:[],plugins:[]}}},Ne.propTypes={layout:r().object,isFormDisabled:r().bool.isRequired,permissions:r().array};var Tn=(0,e.memo)(Ne)},33778:function(z,U,u){"use strict";u.r(U),u.d(U,{default:function(){return B}});var e=u(32735),P=u(13478),r=u(5141),C=u(72041),l=u(39161),D=u(83281),V=u(57269),W=u(33795),J=u.n(W),L=u(5636),E=u(7247),pe=u(60216),Q=u.n(pe);const _=({disabled:Z,role:j,values:A,errors:q,onChange:X,onBlur:te})=>{const{formatMessage:w}=(0,L.useIntl)();return e.createElement(l.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(l.Flex,{direction:"column",alignItems:"stretch",gap:4},e.createElement(l.Flex,{justifyContent:"space-between"},e.createElement(l.Box,null,e.createElement(l.Box,null,e.createElement(l.Typography,{fontWeight:"bold"},j?j.name:w({id:"global.details",defaultMessage:"Details"}))),e.createElement(l.Box,null,e.createElement(l.Typography,{textColor:"neutral500",variant:"pi"},j?j.description:w({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(l.Button,{disabled:!0,variant:"secondary"},w({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:j.usersCount}))),e.createElement(l.Grid,{gap:4},e.createElement(l.GridItem,{col:6},e.createElement(l.TextInput,{disabled:Z,name:"name",error:q.name&&w({id:q.name}),label:w({id:"global.name",defaultMessage:"Name"}),onChange:X,onBlur:te,value:A.name||""})),e.createElement(l.GridItem,{col:6},e.createElement(l.Textarea,{disabled:Z,label:w({id:"global.description",defaultMessage:"Description"}),name:"description",error:q.name&&w({id:q.name}),onChange:X,onBlur:te},A.description||"")))))};_.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},_.propTypes={disabled:Q().bool,errors:Q().object.isRequired,onBlur:Q().func.isRequired,onChange:Q().func.isRequired,role:Q().object,values:Q().object};var ge=_,G=u(8888),ie=u(5173),ee=ie.Ry().shape({name:ie.Z_().required(P.translatedErrors.required)}),ae=()=>{const Z=(0,P.useNotification)(),{formatMessage:j}=(0,L.useIntl)(),{params:{id:A}}=(0,r.useRouteMatch)("/settings/roles/:id"),[q,X]=(0,e.useState)(!1),te=(0,e.useRef)(),{lockApp:w,unlockApp:oe}=(0,P.useOverlayBlocker)(),{trackUsage:Ee}=(0,P.useTracking)(),{isLoading:g,data:ve}=(0,G.U_)(A),{role:ne,permissions:Ae,isLoading:fe,onSubmitSucceeded:ye}=(0,G.Dq)(A),he=async O=>{try{w(),X(!0);const{permissionsToSend:M,didUpdateConditions:le}=te.current.getPermissions();await(0,P.request)(`/admin/roles/${A}`,{method:"PUT",body:O}),ne.code!=="strapi-super-admin"&&(await(0,P.request)(`/admin/roles/${A}/permissions`,{method:"PUT",body:{permissions:M}}),le&&Ee("didUpdateConditions")),te.current.setFormAfterSubmit(),ye({name:O.name,description:O.description}),Z({type:"success",message:{id:"notification.success.saved"}})}catch(M){console.error(M.response);const le=J()(M,"response.payload.message","An error occured"),se=J()(M,"response.payload.data.permissions[0]",le);Z({type:"warning",message:se})}finally{X(!1),oe()}},K=ne.code==="strapi-super-admin";return e.createElement(l.Main,null,e.createElement(P.SettingsPageTitle,{name:"Roles"}),e.createElement(D.Formik,{enableReinitialize:!0,initialValues:{name:ne.name,description:ne.description},onSubmit:he,validationSchema:ee,validateOnChange:!1},({handleSubmit:O,values:M,errors:le,handleChange:se,handleBlur:Ve})=>e.createElement("form",{onSubmit:O},e.createElement(l.HeaderLayout,{primaryAction:e.createElement(l.Flex,{gap:2},e.createElement(l.Button,{disabled:ne.code==="strapi-super-admin",onClick:O,loading:q,size:"L"},j({id:"global.save",defaultMessage:"Save"}))),title:j({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:j({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(P.Link,{startIcon:e.createElement(V.ArrowLeft,null),to:"/settings/roles"},j({id:"global.back",defaultMessage:"Back"}))}),e.createElement(l.ContentLayout,null,e.createElement(l.Flex,{direction:"column",alignItems:"stretch",gap:6},e.createElement(ge,{isLoading:fe,disabled:K,errors:le,values:M,onChange:se,onBlur:Ve,role:ne}),!g&&!fe?e.createElement(l.Box,{shadow:"filterShadow",hasRadius:!0},e.createElement(E.Z,{isFormDisabled:K,permissions:Ae,ref:te,layout:ve})):e.createElement(l.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(P.LoadingIndicatorPage,null)))))))},B=()=>{const Z=(0,e.useMemo)(()=>({read:C.Z.settings.roles.read,update:C.Z.settings.roles.update}),[]),{isLoading:j,allowedActions:{canRead:A,canUpdate:q}}=(0,P.useRBAC)(Z);return j?e.createElement(P.LoadingIndicatorPage,null):!A&&!q?e.createElement(r.Redirect,{to:"/"}):e.createElement(ae,null)}},84802:function(z){function U(u,e,P,r){for(var C=-1,l=u==null?0:u.length;++C<l;){var D=u[C];e(r,D,P(D),u)}return r}z.exports=U},62435:function(z,U,u){var e=u(56671);function P(r,C,l,D){return e(r,function(V,W,J){C(D,V,l(V),J)}),D}z.exports=P},85580:function(z,U,u){var e=u(84802),P=u(62435),r=u(88904),C=u(77236);function l(D,V){return function(W,J){var L=C(W)?e:P,E=V?V():{};return L(W,D,r(J,2),E)}}z.exports=l},81346:function(z,U,u){var e=u(40999),P=u(85580),r=Object.prototype,C=r.hasOwnProperty,l=P(function(D,V,W){C.call(D,W)?D[W].push(V):e(D,W,[V])});z.exports=l}}]);
