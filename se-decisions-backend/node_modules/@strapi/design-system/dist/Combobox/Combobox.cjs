"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("react"),_=require("@strapi/icons"),he=require("prop-types"),ve=require("./ComboboxOption.cjs"),O=require("./components.cjs"),l=require("./utils.cjs"),Ee=require("../Box/Box.cjs"),Fe=require("../Field/Field.cjs"),Ie=require("../Field/FieldLabel.cjs");require("../Field/FieldInput.cjs");const Me=require("../Field/FieldHint.cjs"),Oe=require("../Field/FieldError.cjs");require("../Field/FieldContext.cjs");require("../Field/FieldAction.cjs");const R=require("../Flex/Flex.cjs"),qe=require("../helpers/keyboardKeys.cjs"),je=require("../hooks/useId.cjs"),ke=require("../Loader/Loader.cjs"),Le=require("../Popover/Popover.cjs"),N=require("../Select/components.cjs"),U=require("../Typography/Typography.cjs"),Re=require("../VisuallyHidden/VisuallyHidden.cjs"),z=r=>r&&typeof r=="object"&&"default"in r?r:{default:r},o=z(a),e=z(he),C=({children:r,clearLabel:W,creatable:x,createMessage:G,disabled:d,error:F,hasMoreItems:J,hint:q,id:Q,label:h,labelAction:X,loading:j,loadingMessage:Y,noOptionsMessage:Z,onChange:A,onClear:T,onCreateOption:ee,onInputChange:$,onLoadMore:te,placeholder:oe,required:w,value:p,...ne})=>{const ae=()=>r.find(t=>t.props?.value.toLowerCase()===p.toLowerCase()).props?.children,[c,B]=a.useState(0),[re,le]=a.useState(null),[u,D]=a.useState(r),[m,ie]=a.useState(!1),[i,I]=a.useState(""),v=a.useRef(),M=a.useRef(!1),E=a.useRef(),P=a.useRef(),se=a.useRef(),V=a.useRef(!0),s=je.useId(Q),ce=`${s}-label`;if(!h&&!ne["aria-label"])throw new Error('The Combobox component needs a "label" or an "aria-label" props');a.useEffect(()=>{D(l.filterOptions(r,i))},[i,r]),a.useEffect(()=>{m&&v.current&&l.maintainScrollVisibility(v.current)},[c,m]),a.useLayoutEffect(()=>{V.current&&(V.current=!1)},[p]);const ue=m?`${s}-${c}`:"",K=()=>{A(null),I("")},de=t=>{$&&$(t);const n=E.current.value;D(l.filterOptions(r,n)),B(0),le(null),i!==n&&I(n),m||b(!0,!1)},fe=t=>{const{key:n}=t,f=x&&i?u.length:u.length-1,y=l.getActionFromKey(n,m);switch(p&&!i&&n===qe.KeyboardKeys.BACKSPACE&&K(),y){case l.MenuActions.Next:{if(c===f){g(0);break}g(l.getUpdatedIndex(c,f,y));break}case l.MenuActions.Previous:{if(c===0){g(f);break}g(l.getUpdatedIndex(c,f,y));break}case l.MenuActions.Last:case l.MenuActions.First:{if(c===f){g(0);break}g(l.getUpdatedIndex(c,f,y));break}case l.MenuActions.CloseSelect:t.preventDefault(),k(c);break;case l.MenuActions.Close:t.preventDefault(),b(!1);break;case l.MenuActions.Open:b(!0);break}},pe=t=>{if(t.preventDefault(),p&&!M.current&&I(""),M.current){M.current=!1;return}b(!1,!1)},g=t=>{B(t)},be=t=>{g(t),k(t)},H=()=>{M.current=!0},k=t=>{const n=u[t];if(I(""),n){A(n.props.value),b(!1);return}x&&(ee(i),b(!1))},b=(t,n=!0)=>{ie(t),n&&E.current.focus()},me=a.Children.toArray(u).map((t,n)=>{const f=c===n;return a.cloneElement(t,{id:`${s}-${n}`,"aria-selected":re===n,"aria-posinset":n+1,"aria-setsize":a.Children.toArray(u).length,ref(y){f&&(v.current=y)},onClick:()=>be(n),onMouseDown:H,isSelected:f})}),ge=()=>{E.current.focus(),T&&T(),K()},ye=()=>{E.current.focus(),b(!0)},Ce=()=>{const t=u.findIndex(n=>n.props?.children===i);return i&&t===-1},xe=t=>{t.preventDefault(),b(t,!0)};let L;return F?L=`${s}-error`:q&&(L=`${s}-hint`),o.default.createElement(Fe.Field,{hint:q,error:F,id:s,required:w},o.default.createElement(Re.VisuallyHidden,{"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text"},p),o.default.createElement(R.Flex,{direction:"column",alignItems:"stretch",gap:h||q||F?1:0},h&&o.default.createElement(Ie.FieldLabel,{action:X},h),o.default.createElement(O.MainRow,{ref:P,$disabled:d,hasError:F},o.default.createElement(O.InputContainer,{wrap:"wrap"},!i&&p&&o.default.createElement(O.ValueContainer,{id:`${s}-selected-value`},o.default.createElement(U.Typography,null,ae())),o.default.createElement(O.Input,{"aria-activedescendant":ue,"aria-autocomplete":"list","aria-controls":`${s}-listbox`,"aria-disabled":d,"aria-expanded":m,"aria-haspopup":"listbox","aria-describedby":L,autoComplete:"off",autoCorrect:"off",id:s,onBlur:d?void 0:pe,onClick:d?void 0:xe,onInput:d?void 0:de,onKeyDown:d?void 0:fe,placeholder:p?"":oe,readOnly:d,ref:E,required:w,role:"combobox",spellCheck:"off",type:"text",value:i})),o.default.createElement(R.Flex,null,(p||i)&&o.default.createElement(N.IconBox,{id:`${s}-clear`,"aria-label":W,disabled:d,paddingLeft:3,as:"button",onClick:ge,type:"button"},o.default.createElement(_.Cross,null)),o.default.createElement(N.CaretBox,{disabled:d,paddingLeft:3,"aria-hidden":!0,as:"button",onClick:ye,tabIndex:-1,type:"button"},o.default.createElement(_.CarretDown,null)))),o.default.createElement(Me.FieldHint,null),o.default.createElement(Oe.FieldError,null)),m&&o.default.createElement(Le.Popover,{id:`${s}-popover`,source:P,spacing:4,fullWidth:!0,intersectionId:`${s}-listbox-popover-intersection`,onReachEnd:J&&!j?te:void 0},o.default.createElement("div",{role:"listbox",ref:se,id:`${s}-listbox`,"aria-labelledby":h?ce:void 0},(Boolean(u.length)||x)&&o.default.createElement(o.default.Fragment,null,me,Ce()&&x&&o.default.createElement(ve.ComboboxOption,{isSelected:c===u.length,ref:t=>{c===u.length&&(v.current=t)},onMouseDown:H,onClick:()=>k(),taindex:0},G(i))),!u.length&&!x&&!j&&o.default.createElement(Ee.Box,{paddingLeft:4,paddingRight:4,paddingTop:2,paddingBottom:2,ref:v},o.default.createElement(U.Typography,{textColor:"neutral800"},Z(i))),j&&o.default.createElement(R.Flex,{justifyContent:"center",alignItems:"center",paddingTop:2,paddingBottom:2},o.default.createElement(ke.Loader,{small:!0},Y)))))},S=r=>o.default.createElement(C,{...r,creatable:!0});C.defaultProps={"aria-label":void 0,clearLabel:"clear",creatable:!1,createMessage:r=>`Create "${r}"`,disabled:!1,error:void 0,hasMoreItems:!1,hint:void 0,id:void 0,label:void 0,loading:!1,loadingMessage:"Loading content...",noOptionsMessage:()=>"No results found",onClear:void 0,onCreateOption:void 0,onInputChange:void 0,onLoadMore:void 0,placeholder:"Select or enter a value",value:void 0};S.defaultProps=C.defaultProps;C.propTypes={"aria-label":e.default.string,children:e.default.oneOfType([e.default.arrayOf(e.default.node),e.default.node]),clearLabel:e.default.string,creatable:e.default.bool,createMessage:e.default.func,disabled:e.default.bool,error:e.default.string,hasMoreItems:e.default.bool,id:e.default.string,hint:e.default.oneOfType([e.default.string,e.default.node,e.default.arrayOf(e.default.node)]),label:e.default.string,labelAction:e.default.element,loading:e.default.bool,loadingMessage:e.default.string,noOptionsMessage:e.default.func,onChange:e.default.func.isRequired,onClear:e.default.func,onCreateOption:e.default.func,onInputChange:e.default.func,onLoadMore:e.default.func,placeholder:e.default.string,value:e.default.string};S.propTypes={...C.propTypes,onCreateOption:e.default.func.isRequired};exports.Combobox=C;exports.CreatableCombobox=S;
